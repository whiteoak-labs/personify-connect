Ext.define("Personify.controller.profile.ToggleOption",{extend:"Personify.base.Controller",control:{toggleDirectory:{change:"onUpdateOptionDirectory"},toggleMobileDirectory:{change:"onUpdateOptionMobileDirectory"},view:{painted:"onPainted"}},config:{record:null,isPainted:false,flagToggleDirectory:true,flagToggleMobileDirectory:true,finishedLoadToggleDirectory:true,finishedLoadToggleMobileDirectory:true,flagUpdateData:false},onPainted:function(){this.setIsPainted(true);var b=this;var a=this.getRecord();if(a){Ext.defer(function(){b.setFlagUpdateData(false);var c=b.getToggleDirectory(),d=b.getToggleMobileDirectory();c.setValue(a.get("includeInDirectory"));d.setValue(a.get("includeInMobileDirectory"));b.setFlagUpdateData(true)},500)}},updateRecord:function(b){var c=this;var a=this.getToggleDirectory(),d=this.getToggleMobileDirectory();if(b){if(Ext.os.is.Android&&Ext.os.is.Tablet){Ext.defer(function(){c.setFlagUpdateData(false);a.setValue(b.get("includeInDirectory"));d.setValue(b.get("includeInMobileDirectory"));c.setFlagUpdateData(true)},500)}else{if(this.getIsPainted()){d.setValue(b.get("includeInMobileDirectory"));a.setValue(b.get("includeInDirectory"))}}}else{this.setFinishedLoadToggleMobileDirectory(false);this.setFinishedLoadToggleDirectory(false);a.setValue(false);d.setValue(false)}c.setFlagUpdateData(true)},onUpdateOptionMobileDirectory:function(n,o,p,j,m,a){if(this.getFlagUpdateData()){Ext.Viewport.setMasked({xtype:"loadmask"});var t=this,i=Personify.utils.Configuration.getCurrentUser(),s=t.getToggleMobileDirectory(),c=Personify.utils.ServiceManager.getStoreManager(),g=c.getCustomerStore(),h=Ext.create(g),q=false,d=false,e=false,b=false;var r={Type:this.getRecord().get("type")||"I",MasterCustomerId:i.get("masterCustomerId"),SubCustomerId:i.get("subCustomerId"),OrganizationId:i.get("organizationId"),OrganizationUnitId:i.get("organizationUnitId"),IncludeInMobileDirectory:(s.getValue()==1)};var l=c.getProfileUpdatingStore();var f=Ext.create(l,{dataRequest:r});var k=this.getView();f.load({callback:function(v,u,x){if(x&&v.length){var w=v[0];t.setFinishedLoadToggleMobileDirectory(true);t.setFlagToggleMobileDirectory(false);if(w&&w.EntryProfile.getCount()){t.setRecord(w.EntryProfile.first())}else{n.setValue(m)}if(t.getFinishedLoadToggleDirectory()){Ext.Viewport.setMasked(false);t.setFinishedLoadToggleMobileDirectory(false);t.setFinishedLoadToggleDirectory(false)}}else{n.setValue(m)}Ext.Viewport.setMasked(false)}})}},onUpdateOptionDirectory:function(n,o,p,k,m,a){if(this.getFlagUpdateData()){Ext.Viewport.setMasked({xtype:"loadmask"});var s=this,j=Personify.utils.Configuration.getCurrentUser(),c=s.getToggleDirectory(),d=Personify.utils.ServiceManager.getStoreManager(),h=d.getCustomerStore(),i=Ext.create(h),q=false,e=false,f=false,b=false;var r={Type:this.getRecord().get("type")||"I",MasterCustomerId:j.get("masterCustomerId"),SubCustomerId:j.get("subCustomerId"),OrganizationId:j.get("organizationId"),OrganizationUnitId:j.get("organizationUnitId"),IncludeInDirectory:(c.getValue()==1)};var l=d.getProfileUpdatingStore();var g=Ext.create(l,{dataRequest:r});g.load({callback:function(u,t,w){if(w&&u.length){var v=u[0];s.setFinishedLoadToggleDirectory(true);s.setFlagToggleDirectory(false);if(v&&v.EntryProfile.getCount()){s.setRecord(v.EntryProfile.first())}else{n.setValue(m)}if(s.getFinishedLoadToggleMobileDirectory()){s.setFinishedLoadToggleMobileDirectory(false);s.setFinishedLoadToggleDirectory(false)}}else{n.setValue(m)}Ext.Viewport.setMasked(false)}})}}});