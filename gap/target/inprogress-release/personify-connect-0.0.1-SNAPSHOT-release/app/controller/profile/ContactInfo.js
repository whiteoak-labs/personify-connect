Ext.define("Personify.controller.profile.ContactInfo",{extend:"Personify.base.Controller",requires:["Personify.utils.ItemUtil","Personify.utils.updateparams.Jsonp"],control:{infoPanelsContainer:true,closeContactPanel:{tap:"onCloseInfoPanel"}},config:{mapping:{photoAndRelated:"Personify.view.profile.contactinfo.PhotoAndRelated",phone:"Personify.view.profile.contactinfo.Phone",email:"Personify.view.profile.contactinfo.Email",address:"Personify.view.profile.contactinfo.Address",website:"Personify.view.profile.contactinfo.Website",bio:"Personify.view.profile.contactinfo.Bio",session:"Personify.view.profile.contactinfo.Session"},countryListStore:null,contactInfoRecord:null,errorMessage:"",screenHeight:0},init:function(){this.setRecord(null);if(Ext.os.is.Android){this.setScreenHeight(Ext.getBody().getHeight());Ext.Viewport.element.on("touchstart",this.onTouchStart,this)}},onTouchStart:function(b){var a=this.getScreenHeight()-Ext.getBody().getHeight();this.getInfoPanelsContainer().setPadding("0 0 "+a+" 0")},destroy:function(){if(Ext.os.is.Android){Ext.Viewport.element.un("touchstart",this.onTouchStart,this)}return this.callParent(arguments)},showListInfo:function(g){var e=this;if(e.getView()&&g&&g.length!=0){var c=e.getMapping(),f=e.getInfoPanelsContainer();f.removeAll(true,true);for(var b=0;b<g.length;b++){var a=c[g[b]];if(a){f.add(Ext.create(a))}}f.setHidden(false);var d=this.getInfoPanelsContainer().getItems().items;if(this.getContactInfoRecord()!=null&&(d!=null)&&(d.length!=0)){this.setRecord(this.getContactInfoRecord());this.setContactInfoRecord(null)}}},setRecord:function(a){if(a){var c=this.getInfoPanelsContainer().getItems().items;if((c!=null)&&(c.length>0)){for(var b=0;b<c.length;b++){c[b].setRecord(a)}}else{this.setContactInfoRecord(a)}}},setPresenterRecord:function(c){if(c){var b=this.getInfoPanelsContainer().getItems().items;if((b!=null)&&(b.length!=0)){for(var a=0;a<b.length;a++){b[a].getController().setPresenterRecord(c)}}}},saveData:function(){if(this.validateData()==false){return}var j=this.getView().getRecord().EntryProfile.getAt(0);Personify.utils.Configuration.setCurrentProfileUser(j);var e={InternalKey:j.get("internalKey"),NavigationKey:j.get("navigationKey"),Credentials:j.get("credentials"),Type:j.get("type"),Id:j.get("entryId"),MasterCustomerId:j.get("masterCustomerId"),SubCustomerId:j.get("subCustomerId"),EncrMasterCustomerId:j.get("encrMasterCustomerId"),EncrSubCustomerId:j.get("encrSubCustomerId"),DisplayName:j.get("displayName"),OrganizationId:j.get("organizationId"),OrganizationUnitId:j.get("organizationUnitId"),PreferredCurrency:j.get("preferredCurrency"),JobTitle:j.get("jobTitle"),CCType:j.get("ccType"),CCNumber:j.get("ccNumber"),ModOper:j.get("modOper"),Urls:new Array(),PhoneNumbers:new Array(),Organization:new Array(),Photos:new Array(),CompanyContact:new Array(),Name:new Array(),Emails:new Array(),Roles:new Array(),Addresses:new Array(),Entry:null};e.Name.push({InternalKey:null,NavigationKey:null,Formatted:"",FamilyName:"",GivenName:"",MiddleName:"",HonorificPrefix:"",HonorificSuffix:"",ProfileName:"",Name:null});var a=this.getInfoPanelsContainer().getItems().items;if((a!=null)&&(a.length!=0)){for(var f=0;f<a.length;f++){a[f].getController().updateParams(e)}}var b=Personify.utils.ServiceManager.getStoreManager();var c=b.getProfileUpdatingStore();var d=Ext.create(c,{dataRequest:e});var h=this.getView();Ext.Viewport.setMasked({xtype:"loadmask"});var g=this;d.getProxy().addListener("exception",function(m,k){if(!k){return}var n=JSON.parse(k.responseText);var p=n.error.message.value;if(p.length>200){p=p.substr(0,200)+"..."}var o=p.split(":");if(o.length>1){p=o[1].trim();if(o.length>2){var q=o[2].split(".");for(var l=0;l<q.length;l++){p+="<br />"+q[l].trim()}}}g.setErrorMessage(p)});d.load({callback:function(k,i,m){if(m&&k.length){var l=k[0];h.setRecord(l);var n=l;h.fireEvent("updatedContact",n)}else{Ext.Msg.alert("",g.getErrorMessage());h.fireEvent("updateContactFail")}Personify.utils.Configuration.setCurrentProfileUser(null);Ext.Viewport.setMasked(false)}});return true},updateEditmode:function(d,a){if(this.getView()){var c=this.getInfoPanelsContainer().getItems().items;if((c!=null)&&(c.length!=0)){for(var b=0;b<c.length;b++){c[b].getController().updateEditMode(d,this.getCountryListStore())}}}},validateData:function(){var d=this.getInfoPanelsContainer().getItems().items;var e=new Array();var c=new Array();if((d!=null)&&(d.length!=0)){for(var b=0;b<d.length;b++){c=d[b].getController().validateData();if(c&&c.length!=0){e=e.concat(c)}}}if(e.length!=0){var a=e.join("");Ext.Msg.alert("Errors",a);return false}else{return true}},setBioInfo:function(a){var c=this.getInfoPanelsContainer().getItems().items;if((c!=null)&&(c.length!=0)){for(var b=0;b<c.length;b++){c[b].getController().setBioInfo(a)}}},onCloseInfoPanel:function(){var a=this;Ext.callback(function(){a.getView().fireEvent("closeinfopanel")},a,[],1)}});