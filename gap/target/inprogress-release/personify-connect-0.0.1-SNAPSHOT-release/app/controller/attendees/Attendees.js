Ext.define("Personify.controller.attendees.Attendees",{extend:"Personify.base.Controller",inject:["currentUser"],control:{attendeeslistpanel:{selectattendeesitem:"onSelectAtendeeItemTap"},attendeeInfo:{closeinfopanel:"onCloseAttendessDetailsButtonTap"}},init:function(){this.showListAttendees();this.configComponentDetail()},showListAttendees:function(){var a=this.getView().getRecord();if(a.MeetingRegistrantStore){if(window.plugins.app47){window.plugins.app47.sendGenericEvent("Attendee List")}var b=this.getAttendeeslistpanel();b.getController().setStore(a.MeetingRegistrantStore)}else{this.onGetData(a)}},configComponentDetail:function(){var a=this.getAttendeeInfo();a.getController().hideCloseButton(false);a.getController().setListOfInfo(Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("listinfoAttendee"));a.getController().updateEnableEditToolBox(false);a.getController().addButtonAddToMyAddressBook(Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("useAddToMyAddressBookButton"))},onGetData:function(b){var a=Personify.utils.Configuration.getCurrentUser(),h=this.getAttendeeslistpanel();h.setMasked({xtype:"loadmask"});var c={IsStaffMember:a?a.isStaffMember().toString():false,ItemsPerPage:"10000",MasterCustomerID:a?a.get("masterCustomerId"):"",SubCustomerID:a?a.get("subCustomerId"):"",ProductID:b.get("productID"),StartIndex:"0"},g=Personify.utils.ServiceManager.getStoreManager(),f=g.getAttendeeStore(),e=Ext.create(f),d=Ext.create(f);e.setDataRequest(c);e.load({callback:function(k,j,i){h.setMasked(false);if(i){d.add(k);b.MeetingRegistrantStore=d;if(!h.isDestroyed){h.getController().setStore(e)}}},scope:this})},onSelectAtendeeItemTap:function(e){if(window.plugins.app47){window.plugins.app47.sendGenericEvent("Attendee Detail")}var h=this,a=h.getAttendeeInfo();if(e.get("details")==null){var d={ReqMasterCustomerId:Personify.utils.Configuration.getCurrentUser().get("masterCustomerId"),ReqSubCustomerId:Personify.utils.Configuration.getCurrentUser().get("subCustomerId"),IsStaff:Personify.utils.Configuration.getCurrentUser().isStaffMember(),RecordType:e.get("type")},i=e.get("masterCustomerID"),f=e.get("subCustomerID");if(i!=null&&!(i==="")){d.MasterCustomerId=i}if(f!=null&&!(f==="")){d.SubCustomerId=f}var b=Personify.utils.ServiceManager.getStoreManager();var g=b.getProfileStore();var c=Ext.create(g,{dataRequest:d});h.getView().setMasked({xtype:"loadmask"});c.load({callback:function(k,j,m){if(m&&k.length){var l=k[0];e.data["details"]=l;a.getController().setRecord(e.get("details"));h.getView().setActiveItem(1);a.getController().updateEnableEditToolBox(false)}else{Ext.Msg.alert("","Cannot load attendee profile.")}h.getView().setMasked(false)}})}else{h.getView().setMasked(false);a.getController().setRecord(e.get("details"));h.getView().setActiveItem(1);a.getController().updateEnableEditToolBox(false)}},onCloseAttendessDetailsButtonTap:function(){this.getView().setActiveItem(0);Ext.Viewport.setMasked(false)}});