Ext.define("Personify.controller.phone.Event",{extend:"Personify.base.Controller",control:{eventNavigationView:true,eventPanelPhone:{live:true,listeners:{requestchangeview:"onRequestChangeView",requestopendetail:"openView",backtomain:"onBackToMain"}}},onLoadData:function(){this.getEventPanelPhone().getController().onGetData()},openView:function(a,b){if(typeof a=="string"){a=Ext.create(a,b)}a.addListener("back",this.onBack,this);a.addListener("backtomain",this.onBackToMain,this);a.addListener("requestchangeview",this.onRequestChangeView,this);a.addListener("requestopendetail",this.openView,this);a.addListener("removeagenda",this.onRemoveAgenda,this);a.addListener("addagenda",this.onAddAgenda,this);a.addListener("refreshagenda",this.onRefreshAgenda,this);a.addListener("updatecurrentuser",this.onUpdateCurrentUser,this);if(b){var d=b.record.get("listeners");if(d){for(var e in d){this.getView().addListener(e,d[e],a)}}}var c=this.getEventNavigationView();if(c.getActiveItem().xtype!=a.xtype){c.push(a)}},onRequestChangeView:function(a,b){this.getView().fireEvent("requestchangeview",a,b)},onBack:function(){var f=this,d=f.getEventNavigationView();d.pop();if(d.getActiveItem().getController()["onRefreshData"]){d.getActiveItem().getController().onRefreshData(function(){})}if(!d.getActiveItem().getController()["getExpandEvent"]){return}var g=d.getActiveItem().getController(),c=g.getExpandEvent(),a=g.getEventRecord(),b=0;g.setFlagSelected(false);g.setItemSelected(false);if(c!=null){for(var e in a){if(b===c){Ext.Viewport.setMasked({xtype:"loadmask",message:"Loading..."});setTimeout(function(){if(Ext.get(g.getSelectEventItem().getViewItems()[b].id.trim()).down(".p-filter-button-new")){g.getSelectEventItem().select(a[e])}Ext.Viewport.setMasked(false)},100);break}b++}}g.checkAndCompileFilter()},onBackToEvent:function(){var c=this,a=c.getEventNavigationView(),b=a.getInnerItems().length;if(b>1){a.popToRoot()}},onBackToMain:function(){this.getView().fireEvent("backtomain")},onRemoveAgenda:function(a,b){this.getView().fireEvent("removeagenda",a,b)},onAddAgenda:function(a,b,c){this.getView().fireEvent("addagenda",a,b,c)},onRefreshAgenda:function(a,b,c){this.getView().fireEvent("refreshagenda",c)},onUpdateCurrentUser:function(a,c){var b=this;this.getView().fireEvent("updatecurrentuser",a,function(){var d=b.getEventPanelPhone();if(d){d.getController().onUpdateEventList()}var e=b.getEventNavigationView().getActiveItem();if(e.xtype=="eventDetailPhone"){e.refresh(c)}else{c(true)}})}});