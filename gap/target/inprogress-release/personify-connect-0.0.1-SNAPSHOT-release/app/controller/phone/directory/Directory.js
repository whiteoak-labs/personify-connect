Ext.define("Personify.controller.phone.directory.Directory",{extend:"Personify.controller.directory.Directory",requires:["Personify.view.phone.directory.ContactInfoManagement","Personify.view.phone.directory.DirectoryManagement"],inject:["personify","currentUser","countryListStore"],config:{personify:null,currentUser:null,params:null,staffList:null,callTopicList:null,callSubjectList:{},callTypeList:null,selectedRecord:null,countryListStore:null,flagNeedLoad:null},control:{directoryNavigationView:{},directoryManagementPanel:{listeners:{loadedSelectedContactInfo:"onLoadedSelectedContactInfo",select:"onSelectContactRow",back:"onBack"}}},init:function(){this.callParent(arguments);this.getDataCountryList()},onLoadData:function(){this.getDirectoryManagementPanel().getController().onGetData()},onLoadedSelectedContactInfo:function(a){},onNavigationButtonTapDirectory:function(){},onNavigationButtonTapContactInfo:function(){this.getView().setActiveItem(0)},onLoadedSelectedContactInfo:function(a){this.getView().fireEvent("loadedSelectedContactInfo",a)},onBack:function(){var a=this;var b=a.getView();b.fireEvent("back",this)},onSelectContactRow:function(d,b,g,a,f,c){if(!a.get("details")){this.LoadContactInfo(a)}else{this.openView("Personify.view.phone.directory.ContactInfoManagement",{directorySelectedItem:a,record:a.get("details"),listOfInfo:Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("listInfo"),requestView:"directory",addToMyAddressBookButton:Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("useAddToMyAddressBookButton"),staffList:this.getStaffList(),callTopicList:this.getCallTopicList(),callSubjectList:this.getCallSubjectList(),callTypeList:this.getCallTypeList(),countryListStore:this.getCountryListStore()})}},LoadContactInfo:function(c){var f=this;f.getView().setMasked({xtype:"loadmask",message:"Loading",indicator:true,centered:true,fullscreen:true});var g={ReqMasterCustomerId:Personify.utils.Configuration.getCurrentUser().get("masterCustomerId"),ReqSubCustomerId:Personify.utils.Configuration.getCurrentUser().get("subCustomerId"),IsStaff:Personify.utils.Configuration.getCurrentUser().isStaffMember(),RecordType:c.get("type")};var e=c.get("masterCustomerId"),a=c.get("subCustomerId");if(e!=null&&!(e==="")){g.MasterCustomerId=e}if(a!=null&&!(a==="")){g.SubCustomerId=a}else{g.SubCustomerId="0"}var h=Personify.utils.ServiceManager.getStoreManager();var b=h.getProfileStore();var d=Ext.create(b);d.setDataRequest(g);d.load({callback:function(j,i,l){if(l&&j.length){var k=j[0];c.data["details"]=k;f.openView("Personify.view.phone.directory.ContactInfoManagement",{directorySelectedItem:c,record:c.get("details"),listOfInfo:Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("listInfo"),requestView:"directory",addToMyAddressBookButton:Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("useAddToMyAddressBookButton"),staffList:f.getStaffList(),callTopicList:f.getCallTopicList(),callSubjectList:f.getCallSubjectList(),callTypeList:f.getCallTypeList(),countryListStore:f.getCountryListStore()})}f.getView().setMasked(false)}})},onRequestChangeView:function(a,b){this.openView(a,b)},openView:function(a,b,g,d){if(typeof a=="string"){a=Ext.create(a,b)}a.addListener("back",this.onBackDirectory,this);a.addListener("backtomain",this.onBackToDirectory,this);a.addListener("requestchangeview",this.onRequestChangeView,this);if(b&&b.record){var e=b.record.get("listeners");if(e){for(var f in e){this.getView().addListener(f,e[f],a)}}}var c=this.getDirectoryNavigationView();if((c.getActiveItem().xtype!=a.xtype)||(c.getActiveItem().xtype==a.xtype&&c.getActiveItem().config.request!=a.config.request)){c.push(a)}},onBackDirectory:function(a,e){var d=this,c=d.getDirectoryNavigationView();if(e){var b=c.pop();b.getController().refreshRecordAfterEditing(e);if(b.getController()["setFlagNeedLoad"]){if(d.getFlagNeedLoad()){b.getController().setFlagNeedLoad(true);d.setFlagNeedLoad(null)}else{b.getController().setFlagNeedLoad(null)}}else{d.setFlagNeedLoad(true)}}else{c.pop();d.setFlagNeedLoad(null)}},getDataCountryList:function(){this.callParent(arguments);var a=this;if(a.getView()&&!a.getView().isDestroyed){if(a.getCountryListStore().getCount()==0){a.loadContryList()}}},loadContryList:function(){var d=this;var e=Personify.utils.ServiceManager.getStoreManager();var a=e.getCountryStore();var c=Ext.create(a);var b=new Array();c.load({callback:function(h,g,m){var f=e.getProfileTypeStore();var k=Ext.create(f);for(var j=0;j<h.length;j++){var l=h[j];if((l.get("countryCode")!=="ALL")&&(l.get("countryCode")!=="[ALL]")){b.push({text:l.get("countryDescription"),value:l.get("countryCode")})}}k.setData(b);k.sort("text","ASC");d.setCountryListStore(k);Deft.Injector.configure({countryListStore:{value:k}})}})}});