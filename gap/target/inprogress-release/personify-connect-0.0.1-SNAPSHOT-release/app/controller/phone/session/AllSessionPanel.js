Ext.define("Personify.controller.phone.session.AllSessionPanel",{extend:"Personify.base.Controller",config:{sessionDates:null,currentDate:null,dateIndex:0},control:{allSessionTitleBar:true,allSessionList:{itemtap:"onSessionItemTap"},previousButton:{tap:"onBackSegmentButton"},dateTimeLabel:true,totalEventLabel:true,sessionHeader:true,nextButton:{tap:"onNextSegmentButton"}},setRecord:function(b){if(b){this.getAllSessionTitleBar().setHtml(Personify.utils.ItemUtil.getShortContent(b.get("shortName"),48));if(b.SessionStore&&b.SessionStore.getCount()>0){var d=Personify.utils.ServiceManager.getStoreManager();var a=d.getSessionStore();var c=Ext.create(a);b.SessionStore.each(function(e){c.add(e)});this.getAllSessionList().setStore(c);this.getArrayDates();this.onSelectDefaultDate()}else{this.onGetData(b)}}},onGetData:function(g,h){var i=this;var d=Personify.utils.Configuration.getCurrentUser();var f={MeetingID:g.data.productID,IsStaffMember:d?d.isStaffMember().toString():false,IsMember:d?d.isMember().toString():false,ItemsPerPage:"100000",StartIndex:"0"};var c=Personify.utils.ServiceManager.getStoreManager();var b=c.getSessionStore();var j=Ext.create(b);var a=Ext.create(b);var e=Ext.getStore("agendaStoreListMain");j.setDataRequest(f);j.load({callback:function(l,k,m){if(l.length>0){j.each(function(p){if(e){for(var n=0;n<e.getCount();n++){var o=e.getAt(n);if(o.get("sessionID")==p.get("sessionID")){if(!p.get("isAdded")){p.set("isAdded",true);break}}}}a.add(p);i.getArrayDates();i.onSelectDefaultDate()});i.getAllSessionList().setStore(j);g.SessionStore=a}},scope:this})},getArrayDates:function(){var a=this.getAllSessionList().getStore();if(a){var b=new Array();a.each(function(d){if(d){var c=Personify.utils.ItemUtil.convertStringToDateSession(d.get("startDateTimeString"));if(!Personify.utils.ItemUtil.checkDateInDateArray(b,c)){b.push(c)}}});b.sort(function(d,c){return d>c?1:(d==c?0:-1)});this.setSessionDates(b)}},onSelectDefaultDate:function(){var c=this;var e=this.getSessionDates();var d=new Date();var a=false;var b=0;Ext.Array.each(e,function(f){var g="m/d/y";if(Ext.Date.format(f,g)==Ext.Date.format(d,g)){a=true;d=f;c.setDateIndex(b)}b++});if(e.length>0){this.getSessionHeader().show();if(a){this.onFilterByDate(d)}else{this.onFilterByDate(e[this.getDateIndex()])}}else{this.getSessionHeader().hide()}this.updateShowHidebutton()},onFilterByDate:function(b){var c=this;var a=this.getAllSessionList().getStore();if(a){a.clearFilter();this.setCurrentDate(b);a.filter(function(e){var d=Personify.utils.ItemUtil.convertStringToDateSession(e.get("startDateTimeString"));var f="m/d/y";if(Ext.Date.format(d,f)==Ext.Date.format(b,f)){return e}});a.sort({sorterFn:function(e,d){var h=Personify.utils.ItemUtil.convertStringToDateSession(e.get("startDateTimeString"));var f=Personify.utils.ItemUtil.convertStringToDateSession(d.get("startDateTimeString"));if(h>f){return 1}else{if(h<f){return -1}else{var i=e.get("title");var g=d.get("title");return i>g?1:(i==g?0:-1)}}},direction:"ASC"})}this.getDateTimeLabel().setHtml(Ext.Date.format(b,"F d, Y"));this.getTotalEventLabel().setHtml(a.getCount()+" Events")},onBackSegmentButton:function(){var a=this.getDateIndex();var b=this.getSessionDates();if(a>0){this.setDateIndex(a-1);this.onFilterByDate(b[a-1]);this.updateShowHidebutton()}},onNextSegmentButton:function(){var a=this.getDateIndex();var b=this.getSessionDates();if(a<this.getSessionDates().length){this.setDateIndex(a+1);this.onFilterByDate(b[a+1]);this.updateShowHidebutton()}},updateShowHidebutton:function(){var a=this.getDateIndex();if(a>0){this.getPreviousButton().setDisabled(false)}else{this.getPreviousButton().setDisabled(true)}if(a+1<this.getSessionDates().length){this.getNextButton().setDisabled(false)}else{this.getNextButton().setDisabled(true)}},onSessionItemTap:function(b,c,f,a,d){this.getView().getParent().fireEvent("onsessiontap",a)}});