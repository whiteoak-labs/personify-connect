Ext.define("Personify.controller.tablet.directory.Directory",{extend:"Personify.controller.directory.Directory",requires:["Personify.view.profile.ContactListing","Personify.view.profile.Relationship"],config:{contactInfoData:null,purchasedHistoryData:null,participationData:null,relationshipData:null,selectedRecord:null,contactListingData:null,staffList:null,callTopicList:null,callSubjectList:null,callTypeList:null,selectedRecord:null,countryListStore:null},control:{directoryManagementPanel:{select:"onSelectContactRow"},contactInfoManagementPanel:{live:true,listeners:{updateContactFail:"onUpdateContactFail",updatedContact:"onUpdatedContact",editRecord:"onEditRecord",hideStaffFunction:"hideStaffFunction",showStaffFunction:"showStaffFunction"}},contactinfo:{},staffButtonsPanel:{},contactContainer:{},contactInformationStaffButton:{tap:"onContactInformationStaffButtonTap"},contactPurchaseHistoryStaffButton:{tap:"onContactPurchaseHistoryStaffButtonTap"},participationHistoryStaffButton:{tap:"onParticipationHistoryStaffButtonTap"},relationshipStaffButton:{tap:"onRelationshipStaffButtonTap"},contactListingStaffButton:{tap:"onContactListingStaffButtonTap"},view:{painted:"onPainted"}},init:function(){this.callParent(arguments);this.getContactInfoManagementPanel().setEditmode(false);this.getContactInfoManagementPanel().getController().addButtonAddToMyAddressBook(Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("useAddToMyAddressBookButton"));this.getContactInfoManagementPanel().setCanedit(false);this.getContactInfoManagementPanel().getController().updateEnableEditToolBox(Personify.utils.Configuration.getCurrentUser().isStaffMember());this.getContactInfoManagementPanel().getController().setListOfInfo(Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("listInfo"));this.getStaffButtonsPanel().setDisabled(true);this.toggleDisabledOfButton(true);this.getView().setMasked(false);var a=Personify.utils.Configuration.getCurrentUser().isStaffMember();this.getStaffButtonsPanel().setHidden(!a)},onPainted:function(){Ext.Viewport.setMasked(false)},resetCachedData:function(a){if(this.getView()){this.setSelectedRecord(a);this.setContactInfoData(null);this.setPurchasedHistoryData(null);this.setParticipationData(null);this.setRelationshipData(null)}},toggleDisabledOfButton:function(a){this.getContactInformationStaffButton().setDisabled(a);this.getContactPurchaseHistoryStaffButton().setDisabled(a);this.getParticipationHistoryStaffButton().setDisabled(a);this.getRelationshipStaffButton().setDisabled(a);this.getContactListingStaffButton().setDisabled(a)},refreshSelectedButton:function(a){},onSelectContactRow:function(f,c,i,b,h,d){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}this.getView().setMasked({xtype:"loadmask"});if(b){this.toggleDisabledOfButton(false);this.resetCachedData(b);var g=this.getContactContainer();var a=g.getItems().items[0];if(a.getItemId()!=="contactInfoManagementPanel"){g.removeAll(true,true);a=this.createContactInfoMangementPanel()}if(b.get("details")){a.setRecord(b.get("details"));this.getView().setMasked(false);this.setContactInfoData(b.get("details"));this.toggleColorOfButtons(this.getContactInformationStaffButton())}else{this.LoadContactInfo(b,a)}this.getStaffButtonsPanel().setDisabled(false);g.add(a)}},LoadContactInfo:function(b,a){this.callParent(arguments);this.toggleColorOfButtons(this.getContactInformationStaffButton())},onContactInformationStaffButtonTap:function(b){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}var c=this.getContactContainer();var a=c.getItems().items[0];if(a.getItemId()!=="contactInfoManagementPanel"){c.removeAll(true,true);a=this.createContactInfoMangementPanel();var d=this.getCountryListStore();if(d){a.setCountryListStore(d);a.setRecord(this.getContactInfoData())}c.add(a);this.toggleColorOfButtons(b)}},onContactPurchaseHistoryStaffButtonTap:function(b){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}if(window.plugins.app47){window.plugins.app47.sendGenericEvent("Directory Purchase History")}var d=this.getContactInfoData();if(d&&d.EntryProfile&&d.EntryProfile.getAt(0)){var c=this.getContactContainer();c.removeAll(true,true);c.add(this.createPhotoAndRelatedPanel(d));purchaseHistory=Ext.create("Personify.view.profile.PurchaseHistory",{itemId:"purchasedHistoryPanel"});var a=this.getSelectedRecord();this.setPurchasedHistoryData(purchaseHistory.getController().loadContactData(a));c.add(purchaseHistory);this.toggleColorOfButtons(b)}},onParticipationHistoryStaffButtonTap:function(b){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}if(window.plugins.app47){window.plugins.app47.sendGenericEvent("Directory Participation History")}var d=this.getContactInfoData();if(d&&d.EntryProfile&&d.EntryProfile.getAt(0)){var c=this.getContactContainer();c.removeAll(true,true);c.add(this.createPhotoAndRelatedPanel(d));participationHistory=Ext.create("Personify.view.profile.ParticipationHistory",{itemId:"participartionHistoryPanel"});if(this.getParticipationData()){participationHistory.getController().updateStore(this.getParticipationData())}else{var a=this.getSelectedRecord();this.setParticipationData(participationHistory.getController().loadContactData(a))}c.add(participationHistory);this.toggleColorOfButtons(b)}},onRelationshipStaffButtonTap:function(b){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}if(window.plugins.app47){window.plugins.app47.sendGenericEvent("Directory Relationships")}var d=this.getContactInfoData();if(d&&d.EntryProfile&&d.EntryProfile.getAt(0)){var c=this.getContactContainer();c.removeAll(true,true);c.add(this.createPhotoAndRelatedPanel(d));relationship=Ext.create("Personify.view.profile.Relationship",{itemId:"relationshipPanel"});if(this.getRelationshipData()){relationship.getController().setLoadedStore(this.getRelationshipData())}else{var a=this.getSelectedRecord();this.setRelationshipData(relationship.getController().loadContactData(d.EntryProfile.getAt(0)))}c.add(relationship);this.toggleColorOfButtons(b)}},onContactListingStaffButtonTap:function(b){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}var d=this.getContactInfoData();if(d&&d.EntryProfile&&d.EntryProfile.getAt(0)){var c=this.getContactContainer();c.removeAll(true,true);c.add(this.createPhotoAndRelatedPanel(d));contactListing=Ext.create("Personify.view.profile.ContactListing",{itemId:"contactListingPanel"});this.passDataToChildView(contactListing);if(this.getContactListingData()){contactListing.getController().updateStore(this.getContactListingData())}else{var a=this.getSelectedRecord();this.setContactListingData(contactListing.getController().loadContactData(a))}c.add(contactListing);this.toggleColorOfButtons(b)}},createPhotoAndRelatedPanel:function(a){photoAndRelated=Ext.create("Personify.view.profile.contactinfo.PhotoAndRelated",{docked:"top",style:"background-color: white; margin-bottom: 10px;"});photoAndRelated.setRecord(a);return photoAndRelated},onUpdatedContact:function(a){this.callParent(arguments);this.setContactInfoData(a)},createContactInfoMangementPanel:function(){var a=Ext.create("Personify.view.profile.ContactInfoManagement",{itemId:"contactInfoManagementPanel"});a.getController().addButtonAddToMyAddressBook(Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("useAddToMyAddressBookButton"));a.getController().updateEnableEditToolBox(Personify.utils.Configuration.getCurrentUser().isStaffMember());a.getController().setListOfInfo(Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("listInfo"));this.passDataToChildView(a);return a},toggleColorOfButtons:function(a){this.getContactInformationStaffButton().setCls("p-button-staffFunction");this.getContactInformationStaffButton().setDisabledCls("p-button-directory-disabled");this.getContactInformationStaffButton().setDisabled(false);this.getContactPurchaseHistoryStaffButton().setCls("p-button-staffFunction");this.getContactPurchaseHistoryStaffButton().setDisabledCls("p-button-directory-disabled");this.getContactPurchaseHistoryStaffButton().setDisabled(false);this.getParticipationHistoryStaffButton().setCls("p-button-staffFunction");this.getParticipationHistoryStaffButton().setDisabledCls("p-button-directory-disabled");this.getParticipationHistoryStaffButton().setDisabled(false);this.getRelationshipStaffButton().setCls("p-button-staffFunction");this.getRelationshipStaffButton().setDisabledCls("p-button-directory-disabled");this.getRelationshipStaffButton().setDisabled(false);this.getContactListingStaffButton().setCls("p-button-staffFunction");this.getContactListingStaffButton().setDisabledCls("p-button-directory-disabled");this.getContactListingStaffButton().setDisabled(false);a.setCls("p-button-staffFunction-selected");a.setDisabledCls("p-button-staffFunction-selected");a.setDisabled(true)},hideStaffFunction:function(){this.getStaffButtonsPanel().hide()},showStaffFunction:function(){var a=Personify.utils.Configuration.getCurrentUser().isStaffMember();if(a){this.getStaffButtonsPanel().show()}}});