Ext.define("Personify.proxy.RestService",{extend:"Ext.data.proxy.Rest",alias:"proxy.restservice",config:{enablePagingParams:false,noCache:false,appendId:true,format:null,jsonData:null,batchActions:false,timeout:30000,actionMethods:{create:"POST",read:"POST",update:"PUT",destroy:"DELETE"}},buildUrl:function(f){var i=this,e=f.getOperation(),c=e.getRecords()||[],h=c[0],g=i.getModel(),k=g.getIdProperty(),j=i.getFormat(),a=i.getUrl(f),d=f.getParams()||{},b=(h&&!h.phantom)?h.getId():d[k];if(i.getAppendId()&&b){if(!a.match(/\/$/)){a+="/"}a+=b;delete d[k]}if(j){if(!a.match(/\.$/)){a+="."}a+=j}f.setUrl(a);return i.callParent([f])},doRequest:function(a,g,c){var e=this,f=e.getWriter(),d=e.buildRequest(a),b=this.getJsonData();d.setConfig({headers:e.getHeaders(),timeout:e.getTimeout(),method:e.getMethod(d),callback:e.createRequestCallback(d,a,g,c),scope:e,proxy:e,jsonData:b});if(a.getWithCredentials()||e.getWithCredentials()){d.setWithCredentials(true);d.setUsername(e.getUserName());d.setPassword(e.getPassword())}d=f.write(d);Ext.Ajax.request(d.getCurrentConfig());return d},processResponse:function(k,b,d,c,j,l){var h=this,a=b.getAction(),f,i;if(k===true){f=h.getReader();h.executeSql(d,c);try{i=f.process(c)}catch(g){b.setException(g.message);h.fireEvent("exception",this,c,b);return}if(!b.getModel()){b.setModel(this.getModel())}if(b.process(a,i,d,c)===false){this.fireEvent("exception",this,c,b)}}else{h.setException(b,c);h.fireEvent("exception",this,c,b)}if(typeof j=="function"){j.call(l||h,b)}h.afterRequest(d,k)},executeSql:function(d,a){var c=JSON.stringify(d.getJsonData());var b=d.getUrl();var e=a.responseText;Personify.utils.Sqlite.insertTableData(c,b,e)},browseImageUrlInObject:function(e,d){var c=this;for(var b in d){if(typeof(b)=="object"){c.browseImageUrlInObject(e,d[b])}else{if(b=="imageURL"){var a=d[b];Personify.utils.Sqlite.getTableImage(a,function(f){if(f.rows.length==0){var g=Personify.utils.PhoneGapHelper.randomUUID();e.url.push(a);e.uuid.push(g);d[b]="data\\resources\\"+g+a.substring(a.lastIndexOf("."))}})}}}return{array:e,obj:d}}});