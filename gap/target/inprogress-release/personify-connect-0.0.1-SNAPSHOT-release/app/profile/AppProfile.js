Ext.define("Personify.profile.AppProfile",{extend:"Ext.app.Profile",initStep:0,config:{isCssFileLoaded:false},launch:function(){var a=this;Personify.utils.PhoneGapHelper.listenerConnection();Personify.utils.Configuration.setAllowChangeView(true);window.plugins.loadResources.load(["resources/css/app.css"],function(){if(Ext.os.is.Phone){window.plugins.loadResources.load(["resources/css/phone.css"],Ext.emptyFn)}a.setIsCssFileLoaded(true)});this.loadConfigurations()},loadConfigurations:function(){var a=this;Personify.utils.Configuration.loadConfigurationFromApp47(function(){a.configureUrbanAirship();Ext.callback(a.loadPreferences,a)})},configureUrbanAirship:function(){if(!window.plugins.pushNotification){return}var b=Personify.utils.Configuration.getConfiguration().getAt(0).ConfigStore;if(b){var a=window.plugins.pushNotification;a.setUseProduction(b.get("UrbanAirship-UseProduction"));a.setDevAppId(b.get("UrbanAirship-Dev-Key"));a.setDevSecret(b.get("UrbanAirship-Dev-Secret"));a.setProdAppId(b.get("UrbanAirship-Prod-Key"));a.setProdSecret(b.get("UrbanAirship-Prod-Secret"));a.takeOff()}document.addEventListener("resume",function(){a.resetBadge()});a.getIncoming(function(e){if(e.message){}});function d(e){}function c(e,f){if(!e){}}a.registerEvent("registration",c);a.registerEvent("push",d);a.enablePush();a.registerForNotificationTypes(a.notificationType.badge|a.notificationType.sound|a.notificationType.alert)},loadPreferences:function(){var d=this;var a=Personify.utils.ServiceManager.getModelManager();var c=a.getUserModel();var b=Ext.create(c);Personify.utils.Configuration.setCurrentUser(b);Deft.Injector.configure({currentUser:{value:b}});if(window.plugins.applicationPreferences){window.plugins.applicationPreferences.get("keepUserLogin",function(e){if(e){var f=Ext.create("Ext.data.Store",{autoLoad:true,model:c,data:e,proxy:{type:"memory",reader:"json"}});if(f.getCount()){Personify.utils.Configuration.setCurrentUser(f.first());Deft.Injector.configure({currentUser:{value:f.first()}})}window.plugins.applicationPreferences.get("username",function(g){Personify.utils.Configuration.setUserName(g);Personify.utils.Configuration.getCurrentUser().setUserName(g)});window.plugins.applicationPreferences.get("password",function(g){Personify.utils.Configuration.setPassword(g);Personify.utils.Configuration.getCurrentUser().setPassword(g)})}Ext.callback(d.initViews,d,[],1000)},function(e){d.initViews()});window.plugins.applicationPreferences.get("twitterToken",function(e){if(e){TMA.Twitter.setToken(Ext.JSON.decode(e));window.plugins.applicationPreferences.get("userTwitter",function(g){var h={consumerKey:"6AqyEYuQnznxau9uYns17w",consumerSecret:"eRZZMxdC2gAx5PnMbtcetAqRYPSv6FnA3J21rOAo74",userModel:"Personify.model.twitter.User"};TMA.Twitter.init(h);var f=Ext.create(h.userModel,Ext.JSON.decode(g));TMA.Twitter.setUser(f)})}})}else{Personify.utils.Configuration.loadCountryAndState();d.initViews()}},initViews:function(){var d=this;if(Ext.os.is.Android){document.addEventListener("backbutton",Ext.bind(b,this),false);function b(h){h.preventDefault()}}var a=function(){if(d.getIsCssFileLoaded()){if(Ext.os.is.Android){if(window.plugins.androidHelper){var k=function(n){var o=n+"/resources/css/app47.css";window.plugins.loadResources.load([o],Ext.emptyFn,d)};window.plugins.androidHelper.getPersonifyDataPath(k,null)}var i=device.version;var m=i.split(".");if(parseInt(m[0]<4)||(parseInt(m[0])==4&&parseInt(m[1])==0)){var j="resources/css/input.css";window.plugins.loadResources.load([j],Ext.emptyFn,d)}}else{if(Ext.os.is.iOS){var l=function(n){console.log("Request file system error: "+n)};var h=function(o){var n=o.root.fullPath+"/resources/css/app47.css";window.plugins.loadResources.load([n],Ext.emptyFn,d)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,h,l)}}}else{Ext.callback(a,d,[],500)}};Ext.callback(a,d,[],0);var f=Personify.utils.Configuration.getConfiguration().getAt(0).EventsStore.get("mapData");var e=function(h){h.root.getDirectory("PersonifyCaches",{create:true},function(){Personify.utils.PhoneGapHelper.downloadMapImage(f)})};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,e,Ext.emptyFn);var g=Personify.utils.ServiceManager.getStoreManager();Deft.Injector.configure({session:g.getSessionStore(),mySessionStore:g.getAgendaStore(),storeProfile:g.getProfileStore(),storeExhibitor:g.getExhibitorStore(),shoppingCartStore:g.getShoppingCartStore(),notificationStore:{value:Ext.create(g.getNotificationStore())},mapStore:"Personify.store.base.Map",iCalendarStore:g.getICalendarStore(),allProductStore:{value:Ext.create(g.getProductListStore())}});var c=function(){window.plugins.applicationPreferences.getString("configurationUpdated",function(h){if(h=="1"){Ext.Msg.alert("","The configuration of the app has been updated. Restart the app to see these changes.",Ext.emptyFn)}else{Ext.callback(c,d,[],60*1000)}})};Ext.callback(c,d,[],5*1000)}});