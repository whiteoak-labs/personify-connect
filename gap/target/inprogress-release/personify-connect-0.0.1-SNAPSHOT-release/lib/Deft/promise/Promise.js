Ext.define("Deft.promise.Promise",{alternateClassName:["Deft.Promise"],statics:{when:function(a){var b;if(a instanceof Ext.ClassManager.get("Deft.promise.Promise")||a instanceof Ext.ClassManager.get("Deft.promise.Deferred")){return a.then()}else{if(Ext.isObject(a)&&Ext.isFunction(a.then)){b=Ext.create("Deft.promise.Deferred");a.then(function(c){b.resolve(c)},function(c){b.reject(c)});return b.then()}else{b=Ext.create("Deft.promise.Deferred");b.resolve(a);return b.then()}}},all:function(a){return this.when(a).then({success:function(n){var q,l,i,h,r,d,e,j,p,k,m,c,f,s,g,b,o;r=Ext.create("Deft.promise.Deferred");s=n.length;c=new Array(n);m=0;g=function(t){r.update(t);return t};f=function(t,u){c[t]=u;m++;if(m===s){i();r.resolve(c)}return u};k=function(t){i();r.reject(t);return t};l=function(t){i();r.cancel(t);return t};i=function(){return g=f=k=l=Ext.emptyFn};h=function(t){return function(u){return f(t,u)}};d=function(t){return k(t)};j=function(t){return g(t)};q=function(t){return l(t)};for(e=b=0,o=n.length;b<o;e=++b){p=n[e];if(e in n){this.when(p).then({success:h(e),failure:d,progress:j,cancel:q})}}return r.getPromise()},scope:this})},any:function(a){return this.some(a,1).then({success:function(b){return b[0]}})},some:function(b,a){return this.when(b).then({success:function(p){var t,n,k,u,o,f,g,l,s,m,i,q,h,e,j,d,c,r;d=[];q=a;i=(p.length-q)+1;u=Ext.create("Deft.promise.Deferred");if(p.length<a){u.reject(new Error("Too few Promises or values were supplied to obtain the requested number of resolved values."))}else{o=a===1?"No Promises were resolved.":"Too few Promises were resolved.";j=function(v){u.update(v);return v};h=function(v){d.push(v);q--;if(q===0){k();u.resolve(d)}return v};m=function(v){i--;if(i===0){k();u.reject(new Error(o))}return v};n=function(v){i--;if(i===0){k();u.reject(new Error(o))}return v};k=function(){return j=h=m=n=Ext.emptyFn};e=function(v){return h(v)};f=function(v){return m(v)};l=function(v){return j(v)};t=function(v){return n(v)};for(g=c=0,r=p.length;c<r;g=++c){s=p[g];if(g in p){this.when(s).then({success:e,failure:f,progress:l,cancel:t})}}}return u.getPromise()},scope:this})},memoize:function(d,c,a){var b;b=Deft.util.Function.memoize(d,c,a);return Ext.bind(function(){return this.all(Ext.Array.toArray(arguments)).then(function(e){return b.apply(c,e)})},this)},map:function(c,b){var a;a=function(d){return function(e){return b(e,d,c)}};return this.when(c).then({success:function(i){var f,d,g,h,e;g=new Array(i.length);for(f=h=0,e=i.length;h<e;f=++h){d=i[f];if(f in i){g[f]=this.when(d).then(a(f))}}return this.reduce(g,this.reduceIntoArray,g)},scope:this})},reduce:function(c,b,a){var d;d=arguments.length===3;return this.when(c).then({success:function(f){var e,g;g=this.when;e=[function(i,j,h){return g(i).then(function(k){return g(j).then(function(l){return b(k,l,h,f)})})}];if(d){e.push(a)}return this.when(this.reduceArray.apply(f,e))},scope:this})},reduceArray:function(b,a){var e,g,d,f,c;d=0;g=Object(this);f=g.length>>>0;e=arguments;if(e.length<=1){while(true){if(d in g){c=g[d++];break}if(++d>=f){throw new TypeError()}}}else{c=e[1]}while(d<f){if(d in g){c=b(c,g[d],d,g)}d++}return c},reduceIntoArray:function(b,c,a){b[a]=c;return b}},id:null,constructor:function(a){this.id=a.id;this.deferred=a.deferred;return this},then:function(a){return this.deferred.then.apply(this.deferred,arguments)},otherwise:function(b,a){return this.deferred.otherwise.apply(this.deferred,arguments)},always:function(b,a){return this.deferred.always.apply(this.deferred,arguments)},cancel:function(a){return this.deferred.cancel(a)},getState:function(){return this.deferred.getState()},toString:function(){if(this.id!=null){return"Promise "+this.id}return"Promise"}},function(){if(Array.prototype.reduce!=null){this.reduceArray=Array.prototype.reduce}});