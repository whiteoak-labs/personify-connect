Ext.define("Personify.controller.event.complexevent.notes.AddNote",{extend:"Personify.base.Controller",control:{inputTitleNote:{keyup:"onTitleChange",clearicontap:"onClearTitle"},inputDescriptionNote:{keyup:"onTextChange",change:"onTextChange",show:"onShow",clearicontap:"onClearText"},view:{painted:"onPainted"},panelOfContent:{}},config:{noteId:null,screenHeight:0},init:function(){this.callParent();if(Ext.os.is.Android){this.setScreenHeight(Ext.getBody().getHeight())}},onPainted:function(){var a=this;if(window.plugins.applicationPreferences){window.plugins.applicationPreferences.get("noteDescriptionHeight",function(b){var c=parseInt(b);var d=a.getInputDescriptionNote().getValue();if(c>0&&d.length){a.getInputDescriptionNote().setHeight(c)}else{a.getInputDescriptionNote().setHeight(82)}},function(){a.getInputDescriptionNote().setHeight(82)})}},onShow:function(){this.getInputDescriptionNote().getParent().getScrollable().getScroller().scrollToTop();this.setConfigChangeView()},onAutoSaveNote:function(){var d=this;var f=this.getInputTitleNote().getValue();var c=this.getInputDescriptionNote().getValue();var b=d.getView().getEventId();var e=d.getView().getSessionId()||"";var a=d.getNoteId();if(c.length){Personify.utils.Sqlite.insertTableNotes(f,c,e,b,a,function(g){})}},onClearTextFields:function(){this.getInputTitleNote().setValue(""),this.getInputDescriptionNote().setValue("")},onTextChange:function(g){var b=Ext.DomQuery.select("textarea",g.element.dom)[0];var e=b.scrollHeight;var c=b.clientHeight;var f=b.selectionEnd;var d=b.textLength;if(c<e){this.getInputDescriptionNote().setHeight(e);if(window.plugins.applicationPreferences){window.plugins.applicationPreferences.set("noteDescriptionHeight",e,Ext.emptyFn,Ext.emptyFn)}if(f==d){this.getInputDescriptionNote().getParent().getScrollable().getScroller().scrollToEnd()}else{var a=this.getInputDescriptionNote().getParent().getScrollable().getScroller();a.scrollBy(0,e-c)}}this.setConfigChangeView()},onClearText:function(){this.getInputDescriptionNote().setHeight(82);this.getInputDescriptionNote().getParent().getScrollable().getScroller().scrollToTop();this.setConfigChangeView()},destroy:function(){if(Personify.utils.Configuration.getAllowChangeView()){this.onAutoSaveNote();this.callParent(arguments)}else{Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn)}return this.callParent(arguments)},setNoteTitle:function(a){this.getInputTitleNote().setValue(a)},setNoteItemId:function(a){this.setNoteId(a)},onTitleChange:function(){this.setConfigChangeView()},setConfigChangeView:function(){var b=this.getInputTitleNote().getValue();var a=this.getInputDescriptionNote().getValue();if(a.length>0){if(b.length==0){Personify.utils.Configuration.setAllowChangeView(false)}else{Personify.utils.Configuration.setAllowChangeView(true)}}else{Personify.utils.Configuration.setAllowChangeView(true)}},onClearTitle:function(){this.setConfigChangeView()},setContent:function(b,a){this.getInputTitleNote().setValue(b);this.getInputDescriptionNote().setValue(a)},onShareCurrentNote:function(){if(Personify.utils.Configuration.getAllowChangeView()){var a=this;if(window.plugins.social&&window.plugins.social.available){window.plugins.social.available(function(b){if(b==1){var e=a.getInputTitleNote().getValue()||"";var d=a.getInputDescriptionNote().getValue()||"";var c="Title: "+e+"\nNote: "+d+"\n";window.plugins.social.share(c,"","")}else{Ext.Msg.alert("","Social network plugins is not supported.",Ext.emptyFn)}})}}else{Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn)}},onDeleteNoteButton:function(c){var b=this;var a=b.getNoteId();if(a){Personify.utils.Sqlite.deleteMyNote(a,function(d){if(d){b.setNoteItemId(null);b.onClearTextFields();if(typeof c=="function"){c()}Ext.Msg.alert("","The note has been deleted.",Ext.emptyFn)}})}Personify.utils.Configuration.setAllowChangeView(true)}});