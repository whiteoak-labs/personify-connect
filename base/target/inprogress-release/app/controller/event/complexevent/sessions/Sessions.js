Ext.define("Personify.controller.event.complexevent.sessions.Sessions",{extend:"Personify.base.Controller",control:{segmentedbutton:{},eventScheduleSegment:{tap:"onEventScheduleSegmentTap"},myScheduleSegment:{tap:"onMyScheduleSegmentTap"},complexEventContentCard:{onsessionitemtap:"onEventSesstionItemTap",onbacktosessionlist:"onBackToSessionList"},eventScheduleView:{addsessiontoagenda:"onAddSessionToAgenda",deletesession:"onDeleteSessionToAgenda",refreshmyschesule:"refreshMySchedule",openaddpersonal:"onAddPersonalTap"},myScheduleView:{deletesession:"onDeleteSessionToAgenda",openaddpersonal:"onAddPersonalTap",onupdatesession:"OnUpdateEventSchedule"},sponsorPanel:true,view:{show:"onShow",erased:"onEraseView"}},init:function(){if(window.plugins.app47){window.plugins.app47.sendGenericEvent("Session Detail")}var a=this.getView().getRecord();this.setRecord(a)},onShow:function(){var a=this.getView().getRecord();this.setRecord(a)},setRecord:function(a){var c=this;if(a){this.getView().setRecord(a);this.getEventScheduleView().setRecord(a);this.getMyScheduleView().setRecord(a);var b=a.SponsorListEvent;Personify.utils.ItemUtil.getSponsorListFromJsonFile(Personify.utils.Configuration.getConfiguration().getAt(0).EventsStore.get("sponsorEvents"),a.get("productID"),b,function(){if(b.getCount()>0){if(c.getSponsorPanel){c.getSponsorPanel().getController().setStore(b);c.getSponsorPanel().show()}}else{if(c.getSponsorPanel){c.getSponsorPanel().hide()}}})}},onEventScheduleSegmentTap:function(){var a=this.getComplexEventContentCard();var b=this.getEventScheduleView();a.setActiveItem(b)},onMyScheduleSegmentTap:function(){var b=Personify.utils.Configuration.getCurrentUser();var a=this.getComplexEventContentCard();var d=this.getMyScheduleView();if(b&&b.isLogged()){a.setActiveItem(d)}else{var c=this.getEventScheduleSegment();var e=this.getSegmentedbutton();e.setPressedButtons(c);Personify.utils.ItemUtil.needToLogin()}},onEventSesstionItemTap:function(c,b,d,a){c.deselectAll();c.refresh();this.onUpdatePresenterSession(a);this.getView().fireEvent("opendetailpage",a)},onBackToSessionList:function(){this.getView().fireEvent("backtosessionlist")},onUpdatePresenterSession:function(a){var b=this;var c=this.getView().getMeetingRecord();if(a.SpeakerSession){a.SpeakerSession.each(function(d){if(c.SpeakersListEvent){c.SpeakersListEvent.each(function(e){if(e.get("masterCustomerId")==d.get("masterCustomerId")){d.SessionListStore.removeAll();e.SessionListStore.each(function(f){d.SessionListStore.add(f)})}})}})}},onAddSessionToAgenda:function(a){this.getView().fireEvent("addsessiontoagenda",a,this.getView())},onDeleteSessionToAgenda:function(a){if(a.record){this.getView().fireEvent("deletesession",a.record,this.getView(),a.callback)}else{this.getView().fireEvent("deletesession",a,this.getView())}},refreshMySchedule:function(b,a){this.getMyScheduleView().setMasked({xtype:"loadmask"});this.getMyScheduleView().getController().onGetData(this.getView().getRecord());this.getEventScheduleView().getController().updateSessionList(b,a);this.getMyScheduleView().setMasked(false)},onAddPersonalTap:function(a){this.getView().fireEvent("openaddpersonal",a)},OnUpdateEventSchedule:function(){var a=this.getView().getRecord();var b=new Array();var c=new Array();if(a.MeetingAgendaStore){a.MeetingAgendaStore.each(function(d){b.push(d.get("sessionID"));c.push(d.get("appointmentId"))})}if(b.length>0){this.getEventScheduleView().getController().setRecord(a,b,c)}},onEraseView:function(){this.getSponsorPanel().getController().onHideImage()}});