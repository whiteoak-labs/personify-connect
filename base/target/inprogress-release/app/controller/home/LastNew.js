Ext.define("Personify.controller.home.LastNew",{extend:"Personify.base.Controller",requires:["Personify.view.News"],inject:["personify"],config:{personify:null},control:{lastNewsTitle:{tapTitle:"onTapTitle"},lastNewsContent:true,viewMoreNews:{tap:"onViewMoreNewsTap"}},init:function(){var a=this;a.onUpdateLastNews()},onViewMoreNewsTap:function(){this.getView().fireEvent("onViewMoreNewsTap")},onUpdateLastNews:function(){var a=this;Ext.callback(function(){var h=Ext.create("Personify.store.news.YahooRss");var d=Personify.utils.Configuration.getCurrentUser();var c=a.getPersonify().getAt(0).NewsStore.FeedsStore;var e=[];var b=null;for(var g=0;g<c.getCount();g++){b=c.getAt(g);if(b.get("visible")){if(b.get("private")){if(d.isLogged()){e.push(b);break}}else{e.push(b);break}}}var f=e[0].get("url");h.setFeedUrl(f);h.load({callback:function(j,i,l){var k=Ext.create("Ext.data.Store",{model:"Personify.model.news.YahooRssItem"});if(j[0]!=null){var m=j[0].get("description");var n=Personify.utils.ItemUtil.removeImageHtmlContent(m);j[0].set({description:n});k.setData(j[0]);if(a.getLastNewsContent&&!a.getLastNewsContent().isDestroyed){a.getLastNewsContent().setStore(k);a.getLastNewsTitle().setStore(k)}}}})},a,[],1)},onTapTitle:function(a){if(Ext.os.is.Android){window.open(a.get("link"),"_blank","location=yes,enableViewportScale=yes")}else{window.open(a.get("link"),"_blank","location=no,enableViewportScale=yes")}}});