Ext.define("Personify.controller.phone.exhibitor.DetailItemListExhibitorPhone",{extend:"Personify.base.Controller",config:{noteNumber:0},control:{ptoolbarDetailItemListExhibitorPhone:{onNavigationButtonTap:"onTapNavigationButton"},btnExihibitorDetailLocationPhone:{tap:"onTapBtnExihibitorDetailLocationPhone"},btnExihibitorDetailProductPhone:{tap:"onTapBtnExihibitorDetailProductPhone"},btnExihibitorDetailContactPhone:{tap:"onTapBtnExihibitorDetailContactPhone"},btnExihibitorDetailNotePhone:{tap:"onTapBtnExihibitorDetailNotePhone"},websitePanel:true,phonePanel:true,faxPanel:true,addToMyExhibitor:{tap:"onAddToMyExhibitorTap"}},init:function(){var c=this;c.callParent(arguments);c.setTextAllButton();c.getPtoolbarDetailItemListExhibitorPhone().getController().setHiddenActionButton(true);this.getWebsitePanel().on({tap:{fn:c.onTapWebsitePanel,element:"element",scope:c}});this.getPhonePanel().on({tap:{fn:c.onTapPhonePanel,element:"element",scope:c}});this.getFaxPanel().on({tap:{fn:c.onTapFaxPanel,element:"element",scope:c}});var a=c.getView().getRecord();if(a){this.loadNoteList()}var d=Personify.utils.Configuration.getConfiguration().getAt(0).EventsStore.get("mapData");if(d){var b=d.locations[a.get("boothNos")];if(!b){this.getBtnExihibitorDetailLocationPhone().hide()}}c.updateAddRemoveButton(a)},updateAddRemoveButton:function(a){if(a.get("isAdded")){this.getAddToMyExhibitor().setCls("btnRemoveMyExihibitorPhone");this.getAddToMyExhibitor().setHtml("Delete from My Exhibitor")}else{this.getAddToMyExhibitor().setCls("btnAddMyExihibitorPhone");this.getAddToMyExhibitor().setHtml("Add to My Exhibitor")}},setTextAllButton:function(){var b=this,a=b.getView().getRecord(),c=a.ProductsExhibitor.getCount();numberContacts=a.ContactsExhibitor.getCount();b.getBtnExihibitorDetailProductPhone().setHtml("<b>Products:</b> "+c);b.getBtnExihibitorDetailContactPhone().setHtml("<b>Contacts:</b> "+numberContacts);b.getBtnExihibitorDetailNotePhone().setHtml("<b>Notes:</b> "+b.getNoteNumber())},onTapNavigationButton:function(){this.getView().fireEvent("back",this)},onTapBtnExihibitorDetailLocationPhone:function(){var a=this.getView().getRecord();var b=a.get("boothNos");this.getView().fireEvent("requestopendetail","Personify.view.phone.map.MapNavigation",{record:a,locationData:b})},onTapBtnExihibitorDetailProductPhone:function(){var b=this,a=b.getView().getRecord();b.getView().fireEvent("requestopendetail","Personify.view.phone.exhibitor.ProductExItemPhone",{record:a})},onTapBtnExihibitorDetailContactPhone:function(){var b=this,a=b.getView().getRecord();b.getView().fireEvent("requestopendetail","Personify.view.phone.exhibitor.ContactExItemPhone",{record:a})},onTapBtnExihibitorDetailNotePhone:function(){var b=this.getView().getRecord();var d=this.getView().getMeetingRecord();var f=b.get("masterCustomerID");var c=d.get("productID");var e=b.get("name");var a=Ext.create("Personify.view.phone.note.NoteNavigation",{record:b,eventId:c,sessionId:f,title:e});a.addListener("updatelistnote",this.loadNoteList,this);this.getView().fireEvent("requestopendetail",a,null)},onTapWebsitePanel:function(){var a=this.getView().getRecord();var b=a.get("webSiteURL");if((b.indexOf("http://")!==0)&&(b.indexOf("https://")!==0)){b="http://"+b}if(Ext.os.is.Android){window.open(b,"_blank","location=yes,enableViewportScale=yes")}else{window.open(b,"_blank","location=no,enableViewportScale=yes")}},onTapPhonePanel:function(){var a=this.getView().getRecord();var b=a.get("phone");this.showActionSheet(b,this.getPhonePanel())},onTapFaxPanel:function(){var a=this.getView().getRecord();var b=a.get("fax");this.showActionSheet(b,this.getFaxPanel())},showActionSheet:function(b,a){if(!Ext.os.is.Tablet&&!Ext.os.is.Desktop){var c=Ext.create("Ext.ActionSheet",{width:"250px",height:"143px",style:"margin-top: -20px;",left:"20%",hideOnMaskTap:true,items:[{text:"Call Phone",handler:function(){c.hide();window.plugins.phoneDialer.dial(b)}},{text:"SMS",handler:function(){c.hide();if(window.plugins.smsComposer){window.plugins.smsComposer.showSMSComposer(b,null)}}},{text:"Cancel",ui:"confirm",handler:function(){c.hide()}}]});Ext.Viewport.add(c);c.showBy(a,"tl-br?")}},loadNoteList:function(){var e=this;var a=this.getView().getRecord();var f=this.getView().getMeetingRecord();var g=a.get("masterCustomerID");var d=f.get("productID");var c={eventId:d,sessionId:g};var h=Personify.utils.ServiceManager.getStoreManager();var b=Ext.create(h.getNoteListStore());b.setDataRequest(c);b.load({callback:function(j,i,k){e.setNoteNumber(j.length);e.getBtnExihibitorDetailNotePhone().setHtml("<b>Notes:</b> "+e.getNoteNumber())}})},onAddToMyExhibitorTap:function(){var e=this.getView().getRecord();var a=this.getView().getMeetingRecord();var g=this;var b=Personify.utils.Configuration.getCurrentUser();if(b&&b.isLogged()){var h=a.ExhibitorStore,d=e.get("recordId")||null,i=b.get("masterCustomerId")||null,f=b.get("subCustomerId")||null,c=a.get("productID")||null;if(e.get("isAdded")!=true){Personify.utils.Sqlite.insertTableExhibitor(d,c,i,f,function(j){if(j){g.getView().fireEvent("updatemyexibitors");e.set("isAdded",true);g.updateAddRemoveButton(e);Ext.Msg.alert("","Exhibitor has been added to your exhibitors.",Ext.emptyFn)}else{Ext.Msg.alert("","Add Exhibitor Failed.",Ext.emptyFn)}})}else{Personify.utils.Sqlite.deleteMyExhibitor(d,c,i,f,function(j){if(j){g.getView().fireEvent("updatemyexibitors");e.set("isAdded",false);g.updateAddRemoveButton(e);Ext.Msg.alert("","Exhibitor has been removed.",Ext.emptyFn)}else{Ext.Msg.alert("","Delete Exhibitor Failed.",Ext.emptyFn)}})}}else{Personify.utils.ItemUtil.needToLogin()}}});