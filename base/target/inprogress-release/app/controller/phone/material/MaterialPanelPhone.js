Ext.define("Personify.controller.phone.material.MaterialPanelPhone",{extend:"Personify.base.Controller",control:{ptoolbarMaterialPanelPhone:{onNavigationButtonTap:"onTapNavigationButton"},materialListPhone:{itemtap:"onTapMaterialListPhone"},materialTitleBar:true},init:function(){this.getPtoolbarMaterialPanelPhone().getController().setHiddenActionButton(true);var a=this.getView().getRecord();var b="";if(a.get("shortName")){b=a.get("shortName")}else{if(a.get("title")){b=a.get("title")}}this.getMaterialTitleBar().setHtml(Personify.utils.ItemUtil.getShortContent(b,48));this.setRecord(a)},onTapNavigationButton:function(){this.getView().fireEvent("back",this)},setRecord:function(b){if(b){var a=b.MaterialStore,c=null;if(a){c=b.get("title");if(c){a.each(function(d){if(d!=null){d.set("titleParent","Session: "+c)}})}else{c=b.get("shortName");a.each(function(d){if(d!=null){d.set("titleParent","Event: "+c)}})}this.getMaterialListPhone().setStore(b.MaterialStore)}}},onTapMaterialListPhone:function(c,f,g,d,h,i){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}var j=this;var a=d.get("url");var k=d.get("title");var b=k;if(b!=""){if(h.target.className.indexOf("btn-email-material")!=-1){Personify.utils.PhoneGapHelper.downloadFile(b,a,function(e){if(window.plugins.emailComposer){window.plugins.emailComposer.showEmailComposer("Download file",a,[e],null,null)}})}else{if(h.target.className.indexOf("btn-ppt-material")){this.getView().setMasked({xtype:"loadmask"});Personify.utils.PhoneGapHelper.downloadFile(b,a,function(e){if(e){var l=e.substring(e.lastIndexOf("."));ExternalFileUtil.openWith(e,l)}j.getView().setMasked(false)})}}}else{Ext.Msg.alert("File download","We don't have information about file location.",Ext.emptyFn)}}});