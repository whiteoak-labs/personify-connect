Ext.define("Ext.ux.picker.DateTime",{extend:"Ext.picker.Picker",xtype:"datetimepicker",alternateClassName:"Ext.ux.DateTimePicker",requires:["Ext.DateExtras"],config:{yearFrom:1980,yearTo:new Date().getFullYear(),monthText:(Ext.os.deviceType.toLowerCase()=="phone")?"M":"Month",dayText:(Ext.os.deviceType.toLowerCase()=="phone")?"D":"Day",yearText:(Ext.os.deviceType.toLowerCase()=="phone")?"Y":"Year",hourText:(Ext.os.deviceType.toLowerCase()=="phone")?"H":"Hour",minuteText:(Ext.os.deviceType.toLowerCase()=="phone")?"M":"Minute",ampmText:(Ext.os.deviceType.toLowerCase()=="phone")?"A":"AM/PM",slotOrder:["month","day","year","hour","minute","ampm"],minuteInterval:15,ampm:false},initialize:function(){this.callParent();this.on({scope:this,delegate:"> slot",slotpick:this.onSlotPick})},setValue:function(b,a){if(Ext.isDate(b)){ampm="A";currentHours=hour=b.getHours();if(this.getAmpm()){if(currentHours>12){ampm="P";hour-=12}else{if(currentHours==12){ampm="P"}else{if(currentHours==0){hour=12}}}}b={day:b.getDate(),month:b.getMonth()+1,year:b.getFullYear(),hour:hour,minute:b.getMinutes(),ampm:ampm}}this.callParent([b,a])},getValue:function(){var m={},a,k,d,c,h=this.getItems().items,g=h.length,o,e;for(e=0;e<g;e++){o=h[e];if(o instanceof Ext.picker.Slot){m[o.getName()]=o.getValue()}}a=this.getDaysInMonth(m.month,m.year);k=Math.min(m.day,a),d=m.hour,c=m.minute;var j=(isNaN(m.year))?new Date().getFullYear():m.year,b=(isNaN(m.month))?(new Date().getMonth()):(m.month-1),n=(isNaN(k))?(new Date().getDate()):k,l=(isNaN(d))?new Date().getHours():d,f=(isNaN(c))?new Date().getMinutes():c;if(m.ampm&&m.ampm=="P"&&l<12){l=l+12}if(m.ampm&&m.ampm=="A"&&l==12){l=0}return new Date(j,b,n,l,f)},updateYearFrom:function(){if(this.initialized){this.createSlots()}},updateYearTo:function(){if(this.initialized){this.createSlots()}},updateMonthText:function(a,b){var f=this.getInnerItems,e=f.length,d,c;if(this.initialized){for(c=0;c<e;c++){d=f[c];if((typeof d.title=="string"&&d.title==b)||(d.title.html==b)){d.setTitle(a)}}}},updateDayText:function(a,c){var f=this.getInnerItems,e=f.length,d,b;if(this.initialized){for(b=0;b<e;b++){d=f[b];if((typeof d.title=="string"&&d.title==c)||(d.title.html==c)){d.setTitle(a)}}}},updateYearText:function(e){var d=this.getInnerItems,c=d.length,b,a;if(this.initialized){for(a=0;a<c;a++){b=d[a];if(b.title==this.yearText){b.setTitle(e)}}}},constructor:function(){this.callParent(arguments);this.createSlots()},createSlots:function(){var r=this,f=this.getSlotOrder(),c=r.getYearFrom(),b=r.getYearTo(),m=[],d=[],g=[],p=[],n=[],l=[],j,q,o,a;if(!this.getAmpm()){var e=f.indexOf("ampm");if(e>=0){f.splice(e)}}if(c>b){q=c;c=b;b=q}for(o=c;o<=b;o++){m.push({text:o,value:o})}a=this.getDaysInMonth(1,new Date().getFullYear());for(o=0;o<a;o++){d.push({text:o+1,value:o+1})}for(o=0,j=Ext.Date.monthNames.length;o<j;o++){g.push({text:(Ext.os.deviceType.toLowerCase()=="phone")?Ext.Date.monthNames[o].substring(0,3):Ext.Date.monthNames[o],value:o+1})}var s=(this.getAmpm())?12:23;var h=(this.getAmpm())?1:0;for(o=h;o<=s;o++){p.push({text:this.pad2(o),value:o})}for(o=0;o<60;o+=this.getMinuteInterval()){n.push({text:this.pad2(o),value:o})}l.push({text:"A",value:"A"},{text:"P",value:"P"});var k=[];f.forEach(function(t){k.push(this.createSlot(t,d,g,m,p,n,l))},this);r.setSlots(k)},createSlot:function(d,g,a,f,b,e,c){switch(d){case"year":return{name:"year",align:(Ext.os.deviceType.toLowerCase()=="phone")?"center":"center",data:f,title:this.getYearText(),flex:(Ext.os.deviceType.toLowerCase()=="phone")?1.4:4};case"month":return{name:d,align:(Ext.os.deviceType.toLowerCase()=="phone")?"center":"center",data:a,title:this.getMonthText(),flex:(Ext.os.deviceType.toLowerCase()=="phone")?1.3:4};case"day":return{name:"day",align:(Ext.os.deviceType.toLowerCase()=="phone")?"center":"center",data:g,title:this.getDayText(),flex:(Ext.os.deviceType.toLowerCase()=="phone")?1:2};case"hour":return{name:"hour",align:(Ext.os.deviceType.toLowerCase()=="phone")?"center":"center",data:b,title:this.getHourText(),flex:(Ext.os.deviceType.toLowerCase()=="phone")?1:2};case"minute":return{name:"minute",align:(Ext.os.deviceType.toLowerCase()=="phone")?"center":"center",data:e,title:this.getMinuteText(),flex:(Ext.os.deviceType.toLowerCase()=="phone")?1:2};case"ampm":return{name:"ampm",align:(Ext.os.deviceType.toLowerCase()=="phone")?"center":"center",data:c,title:this.getAmpmText(),flex:(Ext.os.deviceType.toLowerCase()=="phone")?0.8:2}}},onSlotPick:function(b,c,e,d){var a=b.getStore().getAt(b.selectedIndex).get(b.getValueField());b.setValue(a);if(b.getName()==="month"||b.getName()==="year"){this.repopulateDaySlot()}},repopulateDaySlot:function(){var e=this.getDaySlot(),d=[],c=this.getSlotByName("month").getValue(),b=this.getSlotByName("year").getValue(),a;a=this.getDaysInMonth(c,b);for(i=0;i<a;i++){d.push({text:i+1,value:i+1})}if(e.getData().length==d.length){return}e.setData(d)},getSlotByName:function(a){return this.down("pickerslot[name="+a+"]")},getDaySlot:function(){return this.getSlotByName("day")},getDaysInMonth:function(c,b){var a=[31,28,31,30,31,30,31,31,30,31,30,31];return c==2&&this.isLeapYear(b)?29:a[c-1]},isLeapYear:function(a){return !!((a&3)===0&&(a%100||(a%400===0&&a)))},pad2:function(a){return(a<10?"0":"")+a}});