Ext.define("Personify.utils.Configuration",{configuration:null,currentUser:null,username:null,password:null,urlCheckOut:null,profilePictureTimestamp:null,profileUrl:null,allowChangeView:null,discussionUrl:null,currentProfileUser:null,statics:{setConfiguration:function(a){Personify.utils.Configuration.configuration=a},getConfiguration:function(){return Personify.utils.Configuration.configuration},reloadModules:function(){var a=Ext.ComponentQuery.query("#homeView");if(a.length){a[0].getController().onLoadMenu()}},loadConfigurationFromApp47:function(c){var b=this;var a=Ext.create("Personify.store.personify.Personify");a.load(function(){Personify.utils.Configuration.setConfiguration(a);Deft.Injector.configure({personify:{value:a}});if(window.plugins.applicationPreferences&&window.plugins.app47){var e=0;var f=function(){e++;if(e>60){navigator.splashscreen.hide();Ext.Msg.confirm("","We are experiencing a problem downloading your configuration. Do you want to retry?",function(g){if(g=="yes"){navigator.splashscreen.show();e=0;Ext.callback(d,b,[],500)}else{Ext.Msg.alert("","The app cannot start without configuration. Re-launch the app if you want to retry again.",Ext.emptyFn)}})}else{Ext.callback(d,b,[],500)}};var d=function(){window.plugins.applicationPreferences.getString("configurationLoaded",function(j){if(j=="1"){var h={};var i=0;var g=["DefaultConfigurations","DirectoryModule","DiscussionsModule","EventsModule","HomeModule","InfoModule","NewsModule","ProfileModule","Stylesheet"];var k=function(l){h[g[i]]=Ext.JSON.decode(l);i++;if(i<g.length){window.plugins.app47.getConfiguration(g[i],k)}else{Personify.utils.Configuration.updateConfigurationFromApp47(h);Personify.utils.Configuration.loadWebServiceConfigurationFromApp47(c)}};window.plugins.app47.getConfiguration(g[i],k)}else{f()}},function(g){f()})};Ext.callback(d,b,[],0)}else{if(c){c()}}})},loadWebServiceConfigurationFromApp47:function(a){window.plugins.app47.getConfiguration("WebService",function(e){e=Ext.JSON.decode(e);var d=Personify.utils.wsmanager.WSManager;if(e.protocol){d.protocol=e.protocol}if(e.server){d.server=e.server}if(e.path){d.path=e.path}var c=d.headers;if(e["content-type"]){c["Content-Type"]=e["content-type"]}if(e.authorization){c.Authorization=e.authorization}d.headers=c;var b=d.endpoints;if(e["endpoint-directory-entries"]){b.directoryEntries=e["endpoint-directory-entries"]}if(e["endpoint-directory-employees"]){b.directoryEmployees=e["endpoint-directory-employees"]}if(e["endpoint-directory-staffs"]){b.directoryStaffs=e["endpoint-directory-staffs"]}if(e["endpoint-event-meetings"]){b.eventMeetings=e["endpoint-event-meetings"]}if(e["endpoint-event-registered"]){b.eventRegistered=e["endpoint-event-registered"]}if(e["endpoint-event-sessions"]){b.eventSessions=e["endpoint-event-sessions"]}if(e["endpoint-event-agenda"]){b.eventAgenda=e["endpoint-event-agenda"]}if(e["endpoint-event-session-details"]){b.eventSessionDetails=e["endpoint-event-session-details"]}if(e["endpoint-event-session-rating"]){b.eventSessionRating=e["endpoint-event-session-rating"]}if(e["endpoint-event-exhibitors"]){b.eventExhibitors=e["endpoint-event-exhibitors"]}if(e["endpoint-event-registrants"]){b.eventRegistrants=e["endpoint-event-registrants"]}if(e["endpoint-event-agenda-create"]){b.eventGetEmptyMeetingAgenda=e["endpoint-event-agenda-create"]}if(e["endpoint-event-agenda-save"]){b.eventSaveMeetingAgenda=e["endpoint-event-agenda-save"]}if(e["endpoint-event-agenda-get"]){b.eventGetDeleteMeetingAgenda=e["endpoint-event-agenda-get"]}if(e["endpoint-event-agenda-delete"]){b.eventSaveDeleteMeetingAgenda=e["endpoint-event-agenda-delete"]}if(e["endpoint-store-products"]){b.storeProducts=e["endpoint-store-products"]}if(e["endpoint-store-product-detail"]){b.storeProductDetail=e["endpoint-store-product-detail"]}if(e["endpoint-store-shoppingcart"]){b.storeShoppingCart=e["endpoint-store-shoppingcart"]}if(e["endpoint-store-shoppingcart-add"]){b.storeShoppingCartAdd=e["endpoint-store-shoppingcart-add"]}if(e["endpoint-store-shoppingcart-url"]){b.storeShoppingCartUrl=e["endpoint-store-shoppingcart-url"]}if(e["endpoint-store-order"]){b.storeOrder=e["endpoint-store-order"]}if(e["endpoint-profile-get"]){b.profileGet=e["endpoint-profile-get"]}if(e["endpoint-profile-authentication-url"]){b.profileAuthenticationUrl=e["endpoint-profile-authentication-url"]}if(e["endpoint-profile-contacts"]){b.profileContacts=e["endpoint-profile-contacts"]}if(e["endpoint-profile-contact-detail"]){b.profileContactDetails=e["endpoint-profile-contact-detail"]}if(e["endpoint-profile-purchases"]){b.profilePurchases=e["endpoint-profile-purchases"]}if(e["endpoint-profile-participations"]){b.profileParticipations=e["endpoint-profile-participations"]}if(e["endpoint-profile-relationships"]){b.profileRelationships=e["endpoint-profile-relationships"]}if(e["endpoint-profile-biography"]){b.customerBiography=e["endpoint-profile-biography"]}if(e["endpoint-profile-update"]){b.profileUpdate=e["endpoint-profile-update"]}if(e["endpoint-profile-address-delete"]){b.profileAddressDelete=e["endpoint-profile-address-delete"]}if(e["endpoint-profile-contact-add"]){b.profileContactAdd=e["endpoint-profile-contact-add"]}if(e["endpoint-profile-communication-delete"]){b.profileCommunicationDelete=e["endpoint-profile-communication-delete"]}if(e["endpoint-profile-image-update"]){b.profileImageUpdate=e["endpoint-profile-image-update"]}if(e["endpoint-user-login"]){b.userLogin=e["endpoint-user-login"]}if(e["endpoint-user-notifications"]){b.userNotifications=e["endpoint-user-notifications"]}if(e["endpoint-user-preferences"]){b.userPreferences=e["endpoint-user-preferences"]}if(e["endpoint-util-countries"]){b.utilCountries=e["endpoint-util-countries"]}if(e["endpoint-util-states"]){b.utilStates=e["endpoint-util-states"]}if(e["endpoint-util-fileupload"]){b.utilFileUpload=e["endpoint-util-fileupload"]}if(e["endpoint-util-call-type"]){b.utilCallType=e["endpoint-util-call-type"]}if(e["endpoint-util-call-topic"]){b.utilCallTopic=e["endpoint-util-call-topic"]}if(e["endpoint-util-call-subject"]){b.utilCallSubject=e["endpoint-util-call-subject"]}d.endpoints=b;if(a){a()}})},updateConfigurationFromApp47:function(c){var d=Personify.utils.Configuration.getConfiguration();if(d.getCount()<=0||c=={}){return}d=d.first();if(c.InfoModule){if(c.InfoModule["title"]){d.AboutStore.set("title",c.InfoModule["title"])}if(c.InfoModule["version"]){d.AboutStore.set("version",c.InfoModule["version"])}if(c.InfoModule["logo-url"]){d.AboutStore.set("logoUrl",c.InfoModule["logo-url"])}if(c.InfoModule["app-share-title"]){d.AboutStore.set("appShareTitle",c.InfoModule["app-share-title"])}if(c.InfoModule["app-share-text"]){d.AboutStore.set("appShareText",c.InfoModule["app-share-text"])}if(Ext.os.is.Android){if(c.InfoModule["app-url-android"]){d.AboutStore.set("appUrl",c.InfoModule["app-url-android"])}}else{if(Ext.os.is.iOS){if(c.InfoModule["app-url-ios"]){d.AboutStore.set("appUrl",c.InfoModule["app-url-ios"])}}}if(c.InfoModule["description-title"]){d.AboutStore.set("descriptionTitle",c.InfoModule["description-title"])}if(c.InfoModule["description-text"]){d.AboutStore.set("description",c.InfoModule["description-text"])}if(c.InfoModule["contact-phone-title"]){d.AboutStore.set("importantNumbersTitle",c.InfoModule["contact-phone-title"])}if(c.InfoModule["contact-phone-url"]){var l=function(m){d.AboutStore.NumbersStore.setConfig({data:m,proxy:{type:"memory",reader:"json"}})};var f=function(m){d.AboutStore.NumbersStore.setProxy({url:"data/contact_phones.json",type:"rest",reader:"json"});d.AboutStore.NumbersStore.load()};if(window.plugins.app47){window.plugins.app47.getFileValue("InfoModule","contact-phone-url",l,f)}else{f(null)}}if(c.InfoModule["contact-address-title"]){d.AboutStore.set("addressesTitle",c.InfoModule["contact-address-title"])}if(c.InfoModule["contact-address-url"]){var l=function(m){d.AboutStore.AddressesStore.setConfig({data:m,proxy:{type:"memory",reader:"json"}})};var f=function(m){d.AboutStore.AddressesStore.setProxy({url:"data/contact_addresses.json",type:"rest",reader:"json"});d.AboutStore.AddressesStore.load()};if(window.plugins.app47){window.plugins.app47.getFileValue("InfoModule","contact-address-url",l,f)}else{f(null)}}if(c.InfoModule["contact-website-title"]){d.AboutStore.set("websitesTitle",c.InfoModule["contact-website-title"])}if(c.InfoModule["contact-website-url"]){var l=function(m){d.AboutStore.WebsiteStore.setConfig({data:m,proxy:{type:"memory",reader:"json"}})};var f=function(m){d.AboutStore.WebsiteStore.setProxy({url:"data/contact_websites.json",type:"rest",reader:"json"});d.AboutStore.WebsiteStore.load()};if(window.plugins.app47){window.plugins.app47.getFileValue("InfoModule","contact-website-url",l,f)}else{f(null)}}if(c.InfoModule["contact-email-title"]){d.AboutStore.set("emailTitle",c.InfoModule["contact-email-title"])}if(c.InfoModule["contact-email-url"]){var l=function(m){d.AboutStore.EmailStore.setConfig({data:m,proxy:{type:"memory",reader:"json"}})};var f=function(m){d.AboutStore.EmailStore.setProxy({url:"data/contact_emails.json",type:"rest",reader:"json"});d.AboutStore.EmailStore.load()};if(window.plugins.app47){window.plugins.app47.getFileValue("InfoModule","contact-email-url",l,f)}else{f(null)}}if(c.InfoModule["enable-configsettings"]){var b=c.InfoModule["enable-configsettings"];var i=(b.toUpperCase()=="YES")?true:false;d.AboutStore.set("enableConfigSettings",i)}}if(c.NewsModule){if(c.NewsModule["twitter-tag"]){d.NewsStore.set("twitterHashtag",c.NewsModule["twitter-tag"])}if(c.NewsModule["twitter-refresh-interval"]){d.NewsStore.set("refreshInterval",c.NewsModule["twitter-refresh-interval"])}if(c.NewsModule["feeds-url"]){var l=function(n){var m=Ext.JSON.decode(n);d.NewsStore.FeedsStore.setConfig({data:m,proxy:{type:"memory",reader:{type:"json"}}})};var f=function(m){d.NewsStore.FeedsStore.setProxy({url:"data/news_feeds.json",type:"rest",reader:"json"});d.NewsStore.FeedsStore.load()};if(window.plugins.app47){window.plugins.app47.getFileValue("NewsModule","feeds-url",l,f)}else{f(null)}}}if(c.DirectoryModule){if(c.DirectoryModule["itemperpage"]){d.DirectoryStore.set("itemPerPage",c.DirectoryModule["itemperpage"])}if(c.DirectoryModule["defaultsearchterm"]){var g=c.DirectoryModule["defaultsearchterm"]}if(g==="null"){g=""}d.DirectoryStore.set("defaultSearchTerm",g);if(c.DirectoryModule["listinfo-profile"]){var h=[];Ext.Array.each(c.DirectoryModule["listinfo-profile"].split(","),function(m){h.push(m.trim())});d.DirectoryStore.set("listInfo",h)}if(c.DirectoryModule["listinfo-presenter"]){var k=[];Ext.Array.each(c.DirectoryModule["listinfo-presenter"].split(","),function(m){k.push(m.trim())});d.DirectoryStore.set("listinfoPresenter",k)}if(c.DirectoryModule["listinfo-attendee"]){var a=[];Ext.Array.each(c.DirectoryModule["listinfo-attendee"].split(","),function(m){a.push(m.trim())});d.DirectoryStore.set("listinfoAttendee",a)}if(c.DirectoryModule["name-fields-url"]){if(c.DirectoryModule["name-fields-url"]){var l=function(m){d.DirectoryStore.PhotoAndRelatedEditStore.setConfig({data:m,proxy:{type:"memory",reader:"json"}})};var f=function(m){d.DirectoryStore.PhotoAndRelatedEditStore.setProxy({url:"data/directory_name_fields.json",type:"rest",reader:"json"});d.DirectoryStore.PhotoAndRelatedEditStore.load()};if(window.plugins.app47){window.plugins.app47.getFileValue("DirectoryModule","name-fields-url",l,f)}else{f(null)}}}if(c.DirectoryModule["title-fields-url"]){if(c.DirectoryModule["title-fields-url"]){var l=function(m){d.DirectoryStore.JobTitleEditStore.setConfig({data:m,proxy:{type:"memory",reader:"json"}})};var f=function(m){d.DirectoryStore.JobTitleEditStore.setProxy({url:"data/directory_title_fields.json",type:"rest",reader:"json"});d.DirectoryStore.JobTitleEditStore.load()};if(window.plugins.app47){window.plugins.app47.getFileValue("DirectoryModule","title-fields-url",l,f)}else{f(null)}}}if(c.DirectoryModule["enable-addtoaddressbook"]){d.DirectoryStore.set("useAddToMyAddressBookButton",c.DirectoryModule["enable-addtoaddressbook"])}if(c.DirectoryModule["minsearchcharacters"]){d.DirectoryStore.set("minSearchCharacters",c.DirectoryModule["minsearchcharacters"])}}if(c.DefaultConfigurations){if(c.DefaultConfigurations["currency"]){d.ConfigStore.set("currency",c.DefaultConfigurations["currency"])}if(c.DefaultConfigurations["currency-symbol"]){d.ConfigStore.set("currencySymbol",c.DefaultConfigurations["currency-symbol"])}if(c.DefaultConfigurations["itemperpage"]){d.ConfigStore.set("itemPerPage",c.DefaultConfigurations["itemperpage"])}if(c.DefaultConfigurations["UrbanAirship-Dev-Key"]){d.ConfigStore.set("UrbanAirship-Dev-Key",c.DefaultConfigurations["UrbanAirship-Dev-Key"])}if(c.DefaultConfigurations["UrbanAirship-Dev-Secret"]){d.ConfigStore.set("UrbanAirship-Dev-Secret",c.DefaultConfigurations["UrbanAirship-Dev-Secret"])}if(c.DefaultConfigurations["UrbanAirship-Prod-Key"]){d.ConfigStore.set("UrbanAirship-Prod-Key",c.DefaultConfigurations["UrbanAirship-Prod-Key"])}if(c.DefaultConfigurations["UrbanAirship-Prod-Secret"]){d.ConfigStore.set("UrbanAirship-Prod-Secret",c.DefaultConfigurations["UrbanAirship-Prod-Secret"])}if(c.DefaultConfigurations["UrbanAirship-UseProduction"]){d.ConfigStore.set("UrbanAirship-UseProduction",c.DefaultConfigurations["UrbanAirship-UseProduction"])}if(c.DefaultConfigurations["orgid"]){d.ConfigStore.DefaultListingParamsStore.first().set("orgId",c.DefaultConfigurations["orgid"])}if(c.DefaultConfigurations["orgunitid"]){d.ConfigStore.DefaultListingParamsStore.first().set("orgUnitId",c.DefaultConfigurations["orgunitid"])}}if(c.DiscussionsModule){if(c.DiscussionsModule["site-url"]){d.DiscussionStore.set("url",c.DiscussionsModule["site-url"])}if(c.DiscussionsModule["vendor-id"]){d.DiscussionStore.set("vendorId",c.DiscussionsModule["vendor-id"])}if(c.DiscussionsModule["vendor-username"]){d.DiscussionStore.set("vendorUsername",c.DiscussionsModule["vendor-username"])}if(c.DiscussionsModule["vendor-password"]){d.DiscussionStore.set("vendorPassword",c.DiscussionsModule["vendor-password"])}if(c.DiscussionsModule["vendor-block"]){d.DiscussionStore.set("vendorBlock",c.DiscussionsModule["vendor-block"])}}if(c.EventsModule){if(c.EventsModule["types-url"]){var l=function(n){var m=Ext.JSON.decode(n);d.EventsStore.set("types",m)};var f=function(m){Ext.Ajax.request({url:"data/events_types.json",method:"GET",callback:function(o,q,n){var p=Ext.JSON.decode(n.responseText);d.EventsStore.set("types",p)}})};if(window.plugins.app47){window.plugins.app47.getFileValue("EventsModule","types-url",l,f)}else{f(null)}}if(c.EventsModule["maps-url"]){var l=function(m){var n=Ext.JSON.decode(m);d.EventsStore.set("mapData",n)};var f=function(m){Ext.Ajax.request({url:"data/events_maps.json",success:function(n){var o=Ext.JSON.decode(n.responseText);d.EventsStore.set("mapData",o)}})};if(window.plugins.app47){window.plugins.app47.getFileValue("EventsModule","maps-url",l,f)}else{f(null)}}if(c.EventsModule["conference-image-width"]){d.EventsStore.set("conferenceImageWidth",c.EventsModule["conference-image-width"])}if(c.EventsModule["conference-image-height"]){d.EventsStore.set("conferenceImageHeight",c.EventsModule["conference-image-height"])}if(c.EventsModule["rate-title-bar"]){d.EventsStore.set("rateTitleBar",c.EventsModule["rate-title-bar"])}if(c.EventsModule["featured-events-rotation-interval"]){d.EventsStore.set("featuredEventsRotation",c.EventsModule["featured-events-rotation-interval"])}if(c.EventsModule["featured-events-url"]){var l=function(m){var n=Ext.JSON.decode(m);d.EventsStore.set("featuredEvents",n)};var f=function(m){Ext.Ajax.request({url:"data/events_featured.json",success:function(n){var o=Ext.JSON.decode(n.responseText);d.EventsStore.set("featuredEvents",o)}})};if(window.plugins.app47){window.plugins.app47.getFileValue("EventsModule","featured-events-url",l,f)}else{f(null)}}if(c.EventsModule["sponsor-rotation-interval"]){d.EventsStore.set("sponsorRotation",c.EventsModule["sponsor-rotation-interval"])}if(c.EventsModule["sponsor-events-url"]){var l=function(n){var m=Ext.JSON.decode(n);d.EventsStore.set("sponsorEvents",m)};var f=function(m){Ext.Ajax.request({url:"data/events_sponsor.json",success:function(n){var o=Ext.JSON.decode(n.responseText);d.EventsStore.set("sponsorEvents",o)}})};if(window.plugins.app47){window.plugins.app47.getFileValue("EventsModule","sponsor-events-url",l,f)}else{f(null)}}if(c.EventsModule["mobile-registration"]){var j=false;if(c.EventsModule["mobile-registration"].toLowerCase()=="yes"){j=true}else{j=false}d.EventsStore.set("mobileRegistration",j)}}if(c.ProfileModule){if(c.ProfileModule["forgot-password-url"]){d.ProfileStore.set("forgotPasswordUrl",c.ProfileModule["forgot-password-url"])}if(c.ProfileModule["country-list-version"]){var e=c.ProfileModule["country-list-version"];d.ProfileStore.set("countryListVersion",e);Personify.utils.Configuration.loadCountryAndState().then({success:function(){window.plugins.applicationPreferences.set("countryListVersion",e,function(){})},failure:function(){window.plugins.applicationPreferences.set("countryListVersion",0,function(){})}})}}if(c.HomeModule){if(c.HomeModule["notification-refresh-interval"]){d.HomeStore.set("notificationRefreshInterval",c.HomeModule["notification-refresh-interval"])}}if(c.Stylesheet){if(c.Stylesheet["stylesheet-url"]){var l=function(m){};var f=function(m){};if(window.plugins.app47){window.plugins.app47.getFileValue("Stylesheet","stylesheet-url",l,f)}else{f(null)}}}},setCurrentUser:function(a){Personify.utils.Configuration.currentUser=a},getCurrentUser:function(){if(Personify.utils.Configuration.currentUser==null){var a=Ext.create("Personify.model.base.User");Personify.utils.Configuration.currentUser=a}return Personify.utils.Configuration.currentUser},setCurrentProfileUser:function(a){Personify.utils.Configuration.currentProfileUser=a},getCurrentProfileUser:function(){return Personify.utils.Configuration.currentProfileUser},setUserNameAndPassword:function(b,a){Personify.utils.Configuration.username=b;Personify.utils.Configuration.password=a},getUserName:function(){return Personify.utils.Configuration.username},setUserName:function(a){Personify.utils.Configuration.username=a},getPassword:function(){return Personify.utils.Configuration.password},setPassword:function(a){Personify.utils.Configuration.password=a},setUrlCheckOut:function(a){Personify.utils.Configuration.urlCheckOut=a},getUrlCheckOut:function(){return Personify.utils.Configuration.urlCheckOut},getAllowChangeView:function(){return Personify.utils.Configuration.allowChangeView},setAllowChangeView:function(a){Personify.utils.Configuration.allowChangeView=a},getDiscussionUrl:function(){return Personify.utils.Configuration.discussionUrl},setDiscussionUrl:function(a){Personify.utils.Configuration.discussionUrl=a},loadCountryList:function(){var h=Ext.create("Deft.promise.Deferred");var i=false;var c="country_list.json";var b=null;var a=function(j){var k={type:"rest",url:Personify.utils.ServiceManager.getUrlWS("utilCountries"),headers:Personify.utils.ServiceManager.getHeaders(),reader:{implicitIncludes:true,type:"json",rootProperty:"d"}};i=true;g(k)};var e=function(j){window.plugins.applicationPreferences.get("countryListVersion",function(l){var m=Personify.utils.Configuration.getConfiguration().getAt(0).ProfileStore.get("countryListVersion");var k=null;if(l==m){k={type:"rest",url:j,reader:{implicitIncludes:true,type:"json",rootProperty:"d"}}}else{k={type:"rest",url:Personify.utils.ServiceManager.getUrlWS("utilCountries"),headers:Personify.utils.ServiceManager.getHeaders(),reader:{implicitIncludes:true,type:"json",rootProperty:"d"}};i=true}g(k)},a)};var g=function(l){var n=Personify.utils.ServiceManager.getStoreManager();var j=n.getCountryStore();var m=Ext.create(j);var k=new Array();m.setProxy(l);m.load({callback:function(q,p,v){if(v){var o=n.getProfileTypeStore();var s=Ext.create(o);for(var r=0;r<q.length;r++){var u=q[r];if((u.get("countryCode")!=="ALL")&&(u.get("countryCode")!=="[ALL]")){k.push({text:u.get("countryDescription"),value:u.get("countryCode")})}}s.setData(k);s.sort("text","ASC");if(i){if(Ext.os.is.Android){var t={filePath:b,content:p.getResponse().responseText};window.plugins.androidHelper.writeInternalStorageFile(t)}else{if(Ext.os.is.iOS){Personify.utils.PhoneGapHelper.writeFile(c,p.getResponse().responseText)}}}h.resolve(s)}else{h.reject()}Deft.Injector.configure({countryListStore:{value:s}})}})};if(Ext.os.is.Android){if(window.plugins.androidHelper){var f=function(j){b=j+"/"+c;e(b)};window.plugins.androidHelper.getPersonifyDataPath(f,null)}}else{if(Ext.os.is.iOS){var d=function(j){b=j.root.fullPath+"/"+c;e(b)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,d,a)}else{a()}}return h.promise},loadUSStates:function(){var h=Ext.create("Deft.promise.Deferred");var i=false;var d="state_list.json";var c=null;var a=function(j){var k={type:"rest",url:Personify.utils.ServiceManager.getUrlWS("utilStates")+"?%24format=json&%24filter=CountryCodeString%20eq('USA')",headers:Personify.utils.ServiceManager.getHeaders(),reader:{implicitIncludes:true,type:"json",rootProperty:"d"}};i=true;b(k)};var f=function(j){window.plugins.applicationPreferences.get("countryListVersion",function(l){var m=Personify.utils.Configuration.getConfiguration().getAt(0).ProfileStore.get("countryListVersion");var k=null;if(l==m){k={type:"rest",url:j,reader:{implicitIncludes:true,type:"json",rootProperty:"d"}}}else{k={type:"rest",url:Personify.utils.ServiceManager.getUrlWS("utilStates")+"?%24format=json&%24filter=CountryCodeString%20eq('USA')",headers:Personify.utils.ServiceManager.getHeaders(),reader:{implicitIncludes:true,type:"json",rootProperty:"d"}};i=true}b(k)},a)};var b=function(k){var m=Personify.utils.ServiceManager.getStoreManager(),j=m.getStateStore(),l=Ext.create(j);l.setProxy(k);l.load({callback:function(o,n,q){if(q){if(i){if(Ext.os.is.Android){var p={filePath:c,content:n.getResponse().responseText};window.plugins.androidHelper.writeInternalStorageFile(p)}else{if(Ext.os.is.iOS){Personify.utils.PhoneGapHelper.writeFile(d,n.getResponse().responseText)}}}h.resolve(l)}else{h.reject()}Deft.Injector.configure({usStateStore:{value:l}})}})};if(Ext.os.is.Android){if(window.plugins.androidHelper){var g=function(j){c=j+"/"+d;f(c)};window.plugins.androidHelper.getPersonifyDataPath(g,null)}}else{if(Ext.os.is.iOS){var e=function(j){c=j.root.fullPath+"/"+d;f(c)};window.requestFileSystem(LocalFileSystem.PERSISTENT,0,e,a)}else{a()}}return h.promise},loadCountryAndState:function(){return Deft.Promise.all([Personify.utils.Configuration.loadCountryList(),Personify.utils.Configuration.loadUSStates()])}}});