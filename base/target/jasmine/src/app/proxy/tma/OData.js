Ext.define("Personify.proxy.tma.OData",{extend:"Ext.data.proxy.Rest",alias:"proxy.odata",requires:["Ext.XTemplate","Ext.data.writer.Xml"],config:{username:"",password:"",startParam:"$skip",limitParam:"$top",groupParam:null,pageParam:null,format:"xml",useHeaderAuthentication:false,dataRequests:{entryName:null},xmlDocumentTpl:['<tpl for=".">\n<{key}>{value}</{key}></tpl>'],enablePagingParams:true,timeout:30000,extraParams:{},headers:{},actionMethods:{create:"POST",read:"POST",update:"PUT",destroy:"DELETE"},reader:{type:"xml",implicitIncludes:false,record:"entry"},writer:{type:"xml"},noCache:false,appendId:false},applyXmlDocumentTpl:function(a){if(a&&!a.isTemplate){return Ext.create("Ext.XTemplate",a)}return a},prepareXmlData:function(e){var c=this.getWriter(),d=e.getOperation(),b=d.getRecords()||[],a=this.getXmlDocumentTpl(),h=d.getModel(),n=h.getIdProperty(),l=[],f,g,m;if(e.getAction()=="read"){var k=this.getDataRequests();if(k.entryName){for(var m in k){if(f!="entryName"){l.push({key:m,value:k[m]})}}g=a.apply(l);var j="<"+k.entryName+">",i="</"+k.entryName+">",g=j+g+i}}else{if(b.length){f=c.getRecordData(b[0])}if(f){for(m in f){if(m!==n&&f.hasOwnProperty(m)){l.push({key:m,value:f[m]})}}g=a.apply(l)}}return g},doRequest:function(a,g,c){var e=this,f=e.getUsername(),b=e.getPassword(),d=e.buildRequest(a);d.setConfig({headers:e.getHeaders(),timeout:e.getTimeout(),method:e.getMethod(d),callback:e.createRequestCallback(d,a,g,c),scope:e,proxy:e});if((a.getWithCredentials()||e.getWithCredentials())&&!Ext.isEmpty(f)){if(this.getUseHeaderAuthentication()){d.getHeaders()["Authorization"]="Basic "+btoa(f+":"+b)}else{d.setWithCredentials(true);d.getProxy().setUsername(f);d.getProxy().setPassword(b)}}d.setXmlData(this.prepareXmlData(d));Ext.Ajax.request(d.getCurrentConfig());return d},buildUrl:function(f){var e=this,b=f.getOperation().getRecords()||[],a=b[0],d=e.getModel().getIdProperty(),c=e.getUrl(f),g=f.getParams()||{},h=(a&&!a.phantom)?a.getId():g[d];if(a&&!a.phantom){c+="("+a.getId()+")"}else{if(g[d]){c+="("+g[d]+")";delete g[d]}}f.setUrl(c);return c},processResponse:function(g,b,e,a,h,c){var d=this,f=b.getAction();if(f==="read"){this.callParent(arguments)}else{if(f==="create"){this.callParent(arguments)}else{b.setCompleted(true);if(a.status!==204){b.setSuccessful(false);b.setException(a.statusText);d.fireEvent("exception",this,a,b)}if(typeof h=="function"){h.call(c||d,b)}}}}});