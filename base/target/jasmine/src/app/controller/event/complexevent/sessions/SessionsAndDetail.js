Ext.define("Personify.controller.event.complexevent.sessions.SessionsAndDetail",{extend:"Personify.base.Controller",control:{sessionPage:{opendetailpage:"onOpenDetailPage",deletesession:"onDeleteSessionToAgenda",addsessiontoagenda:"onAddSessionToAgenda",openaddpersonal:"onAddPersonalTap",backtosessionlist:"backToSessionList"},sessionDetail:{buttonmapittap:"onMapButtonTap",deletesession:"onDeleteSession",addsessiontoagenda:"onAddSession"},mapSessionPanel:true},init:function(){var a=this;Ext.callback(function(){var b=this.getView().getRecord();a.getMapSessionPanel().setShowAnimation(false);var c=a.getView().getMeetingRecord();if(b){this.getSessionPage().setRecord(b)}if(c){a.getSessionPage().setMeetingRecord(c);a.getSessionDetail().setMeetingRecord(c);a.getMapSessionPanel().setMeetingRecord(c)}a.getMapSessionPanel().setRecord(b)},a,[],1)},setRecord:function(a,b){this.getMapSessionPanel().setShowAnimation(false);if(a){this.getSessionPage().setRecord(a)}if(b){this.getSessionPage().setMeetingRecord(b);this.getSessionDetail().setMeetingRecord(b);this.getMapSessionPanel().setMeetingRecord(b)}this.getMapSessionPanel().setRecord(a)},onOpenDetailPage:function(a){var b=this;this.getSessionDetail().setRecord(a);this.loadSessionDetail(a,function(c){b.getSessionDetail().getController().onUpdateData(c);b.getView().setActiveItem(1)})},loadSessionDetail:function(b,h){var a=Personify.utils.Configuration.getCurrentUser();var e=this;e.getView().setMasked({xtype:"loadmask"});var c={sessionID:b.get("sessionID"),MasterCustomerID:a?a.get("masterCustomerId"):"",SubCustomerID:a?a.get("subCustomerId"):"0"};var g=Personify.utils.ServiceManager.getStoreManager();var f=g.getSessionDetailStore();var d=Ext.create(f);d.setDataRequest(c);d.load({callback:function(j,i,k){if(k){if(typeof h=="function"){h(d)}}else{Ext.Msg.alert("","Error occurred while loading session detail.")}e.getView().setMasked(false)},scope:this})},backToSessionList:function(){this.getView().setActiveItem(0)},onOpenSessionPage:function(){this.getView().setActiveItem(0)},onDeleteSessionToAgenda:function(b,a,c){this.getView().getParent().fireEvent("deletesession",b,null,null,c)},onAddSessionToAgenda:function(a){this.getView().getParent().fireEvent("addsessiontoagenda",a,null)},onAddPersonalTap:function(a){this.getView().getParent().fireEvent("openaddpersonal",a)},onMapButtonTap:function(a){this.getMapSessionPanel().getController().filterMapsByProduct();this.getMapSessionPanel().getController().getExhibitorStore();this.getMapSessionPanel().setRecord(a);this.getMapSessionPanel().getController().setCurrentLocation(a.get("location"));this.getMapSessionPanel().getController().showMarker();this.getMapSessionPanel().getController().selectItemMyAgenda(a);this.getView().setActiveItem(2)},onDeleteSession:function(b,a){this.getView().getParent().fireEvent("deletesession",b,a)},onAddSession:function(b,a){this.getView().getParent().fireEvent("addsessiontoagenda",b,a)},refreshMySchedule:function(b,a){this.getSessionPage().getController().refreshMySchedule(b,a)}});