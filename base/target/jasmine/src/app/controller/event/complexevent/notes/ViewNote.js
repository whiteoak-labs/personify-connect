Ext.define("Personify.controller.event.complexevent.notes.ViewNote",{extend:"Personify.base.Controller",control:{inputTitleNote:true,inputDescriptionNote:true,deleteNoteButton:{tap:"onDeleteNote"},shareCurrentButton:{tap:"onShareCurrentNote"},addNewButton:{tap:"onAddNewNoteButtonTap"},addNotePanel:{}},setRecord:function(a){if(a){this.getView().setRecord(a);this.getInputTitleNote().setValue(a.get("title"));this.getInputDescriptionNote().setValue(a.get("description"));this.getAddNotePanel().getController().setNoteItemId(a.get("noteId"))}},onShareCurrentNote:function(){if(Personify.utils.Configuration.getAllowChangeView()){var a=this;if(window.plugins.social&&window.plugins.social.available){window.plugins.social.available(function(b){if(b==1){var e=a.getInputTitleNote().getValue()||"";var d=a.getInputDescriptionNote().getValue()||"";var c="Title: "+e+"\nNote: "+d+"\n";window.plugins.social.share(c,"","")}else{Ext.Msg.alert("","Social network plugins is not supported.",Ext.emptyFn)}})}}else{Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn)}},onDeleteNote:function(){var a=this.getView().getRecord();var c=this;Ext.Msg.confirm("","Are you sure you want to delete the Note",b);function b(d){Ext.Msg.hide();if(d=="yes"){if(a){Ext.Viewport.setMasked({xtype:"loadmask"});Personify.utils.Sqlite.deleteMyNote(a.get("noteId"),function(e){Ext.Viewport.setMasked(false);if(e){c.getView().fireEvent("addnewnote");Ext.Msg.alert("","Note has been deleted.",Ext.emptyFn)}else{Ext.Msg.alert("","Delete Note Failed.",Ext.emptyFn)}})}}}},onAddNewNoteButtonTap:function(){this.getAddNotePanel().getController().onAutoSaveNote();this.getView().fireEvent("addnewnote")},setNoteTitle:function(a){this.getAddNotePanel().getController().setNoteTitle(a)},onClearTextFields:function(){this.getAddNotePanel().getController().onClearTextFields()},setEventId:function(a){this.getAddNotePanel().setEventId(a)},setNoteItemId:function(a){this.getAddNotePanel().getController().setNoteItemId(a)},clearNoteId:function(){this.getAddNotePanel().getController().setNoteItemId(null)}});