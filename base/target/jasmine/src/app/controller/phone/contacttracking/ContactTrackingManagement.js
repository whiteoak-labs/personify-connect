Ext.define("Personify.controller.phone.contacttracking.ContactTrackingManagement",{extend:"Personify.controller.profile.ContactListing",requires:["Personify.view.phone.contacttracking.ContactDetailPanel","Personify.view.phone.contacttracking.InquiryPanel"],control:{contactList:{itemtap:"onItemTap",scrollend:"onNextButtonTap"},contactTrackingToolbar:{onNavigationButtonTap:"onBack",actionButtonTap:"onNewContactInquiry"}},config:{params:null,currentContact:null,selectedRecord:null,callTypeList:null,staffList:null,callTopicList:null,callSubjectList:{},countryListStore:null},init:function(){this.callParent(arguments);var f=this;var c=f.getView().config;var a=f.getView().config.record;f.getContactTrackingToolbar().getController().setActionText("Add");if(a&&a.EntryProfile&&a.EntryProfile.getAt(0)){f.loadContactData(a.EntryProfile.getAt(0))}var g=c.staffList;var e=c.callTopicList;var h=c.callSubjectList;var d=c.callTypeList;var b=c.countryListStore;this.setStaffList(g);this.setCallTopicList(e);this.setCallSubjectList(h);this.setCallTypeList(d);this.setCountryListStore(b)},onBack:function(){var a=this;var b=a.getView();b.fireEvent("back",this,null)},onItemTap:function(l,i,j,h,k,m){if(h){this.setSelectedRecord(h)}else{if(this.getSelectedRecord()){h=this.getSelectedRecord();h.set("details",null)}}var n=this;if(h.get("details")){var b=h.get("details");this.getView().fireEvent("requestchangeview","Personify.view.phone.contacttracking.ContactDetailPanel",{record:b,currentContact:n.getCurrentContact(),delegate:n,staffList:n.getStaffList(),callTopicList:n.getCallTopicList(),callTypeList:n.getCallTypeList(),callSubjectList:n.getCallSubjectList()})}else{var f=Personify.utils.Configuration.getCurrentUser();var d=this.getCurrentContact();if(d){var g={MasterCustomerId:d.get("masterCustomerId"),SubCustomerId:d.get("subCustomerId"),StaffId:(f.get("id")!=null)?f.get("id"):"",ActivityId:h.get("activityId")}}var a=Personify.utils.ServiceManager.getStoreManager();var o=a.getProfileContactTrackingStore();var c=Ext.create(o,{dataRequest:g});Ext.Viewport.setMasked({xtype:"loadmask"});c.load({callback:function(p,e,r){if(r&&p.length){var q=p[0];h.set("details",q);Ext.Viewport.setMasked(false);n.getView().fireEvent("requestchangeview","Personify.view.phone.contacttracking.ContactDetailPanel",{record:q,currentContact:n.getCurrentContact(),delegate:n,staffList:n.getStaffList(),callTopicList:n.getCallTopicList(),callTypeList:n.getCallTypeList(),callSubjectList:n.getCallSubjectList()})}},scope:n})}},onNewContactInquiry:function(){this.getView().fireEvent("requestchangeview","Personify.view.phone.contacttracking.InquiryPanel",{staffList:this.getStaffList(),callTopicList:this.getCallTopicList(),callTypeList:this.getCallTypeList(),callSubjectList:this.getCallSubjectList(),record:this.getCurrentContact(),delegate:this,request:"new contact"})},refreshRecordAfterEditing:function(a){if(a){if(a.subjectList){this.getView().config.callSubjectList=a.subjectList;this.setCallSubjectList(a.subjectList)}}}});