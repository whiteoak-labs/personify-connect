Ext.define("Personify.controller.phone.store.Store",{extend:"Personify.base.Controller",requires:["Personify.view.phone.store.StoreManagement"],inject:["shoppingCartStore"],control:{storeNavigationView:{},storeManagementPanel:{listeners:{back:"onBack",requestchangeview:"onRequestChangeView"}}},config:{shoppingCartStore:null},init:function(){this.callParent(arguments)},onLoadData:function(){this.getStoreManagementPanel().getController().onGetData()},onRequestChangeView:function(a,b){this.openView(a,b)},openView:function(a,c,g,d){if(typeof a=="string"){a=Ext.create(a,c)}a.addListener("back",this.onBackStore,this);a.addListener("requestchangeview",this.onRequestChangeView,this);a.addListener("checkoutshoppingcart",this.onTapCartItemCheckout,this);a.addListener("updatecurrentuser",this.onUpdateCurrentUser,this);if(c&&c.record){var e=c.record.get("listeners");if(e){for(var f in e){this.getView().addListener(f,e[f],a)}}}var b=this.getStoreNavigationView();if(b.getActiveItem().xtype!=a.xtype){b.push(a)}},onBack:function(){var a=this;thisView=a.getView();thisView.fireEvent("back",this)},onBackStore:function(){var a=this.getStoreNavigationView().pop()},onTapCartItemCheckout:function(){var c=this;if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}if(window.plugins.app47){window.plugins.app47.sendGenericEvent("View Shopping Cart")}var a=Personify.utils.Configuration.getCurrentUser();if(a&&a.isLogged()){var d=Personify.utils.Configuration.getUrlCheckOut();if(!d){Ext.Msg.alert("","Cannot check out shopping cart.");return}var b=null;if(Ext.os.is.Android){b=window.open(d,"_blank","location=yes,enableViewportScale=yes")}else{b=window.open(d,"_blank","location=no,enableViewportScale=yes")}b.addEventListener("exit",function(){Ext.callback(c.setTotalItemCheckout,c)})}else{this.openView("Personify.view.phone.login.LoginPhone",null)}},onUpdateCurrentUser:function(a,c){var b=this;this.getView().fireEvent("updatecurrentuser",a,function(){if(c){c(true)}})},setTotalItemCheckout:function(){var e=this,b=Personify.utils.Configuration.getCurrentUser(),c=null,a=null;if(b&&b.isLogged()){c=b.get("masterCustomerId"),a=b.get("subCustomerId");var f=e.getShoppingCartStore(),d={MasterCustomerId:c,SubCustomerId:a};f.setDataRequest(d);f.load({callback:function(h,g,i){Deft.Injector.configure({shoppingCartStore:{value:f}})}})}}});