Ext.define("Personify.controller.phone.store.BackOrderPanel",{extend:"Personify.controller.store.BackOrderPanel",config:{product:null,callback:null},control:{btnCancel:{tap:"onCloseForm"},btncheckout:{tap:"onBuyNow"},closeorderForm:{tap:"onCloseForm"}},onBuyNow:function(){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}var f=this;var e=f.getProduct().get("productID");Ext.Viewport.setMasked({xtype:"loadmask"});f.getView().destroy();var a=Personify.utils.Configuration.getCurrentUser();var d=Personify.utils.Configuration.getConfiguration().getAt(0).ConfigStore.DefaultListingParamsStore.getAt(0);var g=Personify.utils.ServiceManager.getStoreManager();var c=Ext.create(g.getOrderFalse());var b={CusAddressID:"",MasterCustomerID:a.get("masterCustomerId"),SubCustomerID:a.get("subCustomerId"),ProductID:e,OrgID:a?a.get("organizationId"):d.get("orgId"),OrgUnitID:a?a.get("organizationUnitId"):d.get("orgUnitId"),CustomPrice:"",ConfirmOrder:"false"};c.setDataRequest(b);c.load({callback:function(l,k,m){if(m){var j=Ext.create(g.getProfileStore());var i=a.isStaffMember();var h={MasterCustomerId:a.get("masterCustomerId"),SubCustomerId:a.get("subCustomerId"),ReqMasterCustomerId:a.get("masterCustomerId"),ReqSubCustomerId:a.get("subCustomerId"),IsStaff:i,RecordType:""};j.setDataRequest(h);j.load({callback:function(B,w,u){Ext.Viewport.setMasked(false);var y=[];var F=Ext.create("Personify.base.Store",{model:"Personify.model.jsonp.profile.Addresses"});if(u){if(B[0]){var E=B[0];if(E.EntryProfile.getAt(0)){var D=E.EntryProfile.getAt(0);var q=D.AddressesProfile.getCount();for(var C=0;C<q;C++){var r=D.AddressesProfile.getAt(C);var z=r.get("streetAddress"),t=r.get("locality"),o=r.get("region"),v=r.get("postalCode"),A=r.get("country"),n=r.get("addressesId"),p=r.get("type");y.push({streetAddress:z,locality:t,region:o,postalCode:v,country:A,addressesId:n,type:p})}F.add(y)}}}var x=Ext.create("Personify.view.phone.store.OrderPanel");var s=f.getCallback();x.getController().setProduct(f.getProduct());x.getController().setIsProductEvent(false);Ext.Viewport.add(x);x.getController().getOrderTemplate().setStore(c);x.getController().getShippingAddress().setStore(F);if(s){x.getController().setCallback(s)}if(F.getCount()>0){x.getController().getShippingAddress().select(0)}x.show()}})}else{Ext.Viewport.setMasked(false);Ext.Msg.alert("Shopping Cart","Cannot process order at this time.",Ext.emptyFn)}}})},onCloseForm:function(){var a=this.getCallback();if(a){Ext.callback(a.fn,a.scope,a.args)}this.getView().destroy()}});