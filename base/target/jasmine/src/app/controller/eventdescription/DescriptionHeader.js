Ext.define("Personify.controller.eventdescription.DescriptionHeader",{extend:"Personify.base.Controller",control:{timeLabel:true,titleOfEvent:true,locationFullAddress:{onTapAddressList:"onTapAddressList"},location:true,inMySchedule:{tap:"onAddToMyScheduleButton"},shareButton:{tap:"onTapShareButton"},shareCalendar:{tap:"onTapShareCalendar"}},config:{data:null,address:null},setRecord:function(c){if(c){this.getView().setRecord(c);var e=Ext.Date.format(Personify.utils.ItemUtil.convertStringToDate(c.get("startDateTimeString")),"F d");var b=Ext.Date.format(Personify.utils.ItemUtil.convertStringToDate(c.get("endDateTimeString")),"F d");var d=c.get("timeZoneCode");this.getTimeLabel().setHtml(e+" - "+b+" "+d);this.getTitleOfEvent().setHtml(c.get("shortName"));if(c.get("locationFullAddress")){var a=c.get("locationFullAddress").split("\r\n").join("<br>");this.getLocationFullAddress().setHtml(a);this.setAddress(a)}this.getLocation().setHtml(c.get("location"));if(c.get("isAdded")){this.getInMySchedule().setCls("p-button-RemoveSchedule");this.getInMySchedule().setHtml("Remove")}else{this.getInMySchedule().setCls("p-button-AddToSchedule");this.getInMySchedule().setHtml("Add to My<br/>Schedule")}}},onAddToMyScheduleButton:function(){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}var a=Personify.utils.Configuration.getCurrentUser();if(a&&a.isLogged()){var b=this.getView().getRecord().get("isAdded");this.getView().fireEvent("inmyscheduletap",b)}else{Personify.utils.ItemUtil.needToLogin()}},onTapShareButton:function(b,c,a){if(this.getView().getRecord()){Personify.utils.ItemUtil.onShareEvent(this.getView().getRecord())}},onTapShareCalendar:function(){var h=this;if(window.plugins.calendarPlugin&&window.plugins.calendarPlugin.createEvent){var a={};var e=h.getView().getRecord();var i=e.get("shortName");var d=Personify.utils.ItemUtil.formatJSONDate(Personify.utils.ItemUtil.convertStringToDate(e.get("startDateTimeString")));var b=Personify.utils.ItemUtil.formatJSONDate(Personify.utils.ItemUtil.convertStringToDate(e.get("startDateTimeString")),"g:i a");var g=Personify.utils.ItemUtil.formatJSONDate(Personify.utils.ItemUtil.convertStringToDate(e.get("endDateTimeString")),"g:i a");var c=b+" - "+g;var j=e.get("locationFullAddress");var f="Title: "+i+"\nDate: "+d+"\nTime: "+c+"\nLocation: "+j;a.title=i;a.location=j;a.body=f;a.startDate=e.get("startDateTime");a.endDate=e.get("endDateTime");a.calendarName=i;window.plugins.calendarPlugin.createEvent(a,function(){Ext.Msg.alert("","Saved to calendar successfully.",Ext.emptyFn)},function(){if(Ext.os.is.Android){Ext.Msg.alert("Calendar","To use this function, you have to allow this mobile application to access your contacts",Ext.emptyFn)}else{Ext.Msg.alert("Calendar","To use this function, you have to allow this mobile application to access your contacts by changing iOS settings in Settings > Privacy > Calendars",Ext.emptyFn)}})}},onTapAddressList:function(){var a=this.getAddress();if(a){Personify.utils.ItemUtil.showAddressOnMaps(a)}}});