Ext.define("Personify.controller.help.AboutAPA",{extend:"Personify.base.Controller",inject:["personify"],control:{titlePanel:true,descriptionPanel:true,importantNumbersPanel:true,addressPanel:true,websitePanel:true,emailPanel:true,bntApp47IdSettings:{tap:"onTapApp47IdSettings"},version:true,phoneList:true,addressList:{itemtap:"onTapAddressList"},emailList:true,websiteList:true,imageFrame:true,addToMyAddressBookButton:{tap:"onTapAddToMyAddressBookButton"},tellAFriend:{tap:"onTellAFriend"},configContainer:true},config:{tempData:null,personify:null},init:function(){var b=this;var c=b.getPersonify().getAt(0).AboutStore;if(c!=null){b.setTempData(c);b.getTitlePanel().setHtml(c.get("title"));b.getVersion().setHtml("Version: "+c.get("version"));b.getImageFrame().setSrc(c.get("logoUrl"));b.getDescriptionPanel().updateTitle(c.get("descriptionTitle"));b.getDescriptionPanel().setHtml(c.get("description"));b.getImportantNumbersPanel().updateTitle(c.get("importantNumbersTitle"));b.getImportantNumbersPanel().updateStore(c.NumbersStore);b.getAddressPanel().updateTitle(c.get("addressesTitle"));b.getAddressPanel().updateStore(c.AddressesStore);b.getWebsitePanel().updateTitle(c.get("websitesTitle"));b.getWebsitePanel().updateStore(c.WebsiteStore);b.getEmailPanel().updateTitle(c.get("emailTitle"));b.getEmailPanel().updateStore(c.EmailStore);var a=c.get("enableConfigSettings");if(a){b.getConfigContainer().setHidden(false)}}},onTapAddToMyAddressBookButton:function(){var j=this;var c=this.getTempData();var b=[],a=[],e=[],i=[];myContact=navigator.contacts.create();myContact.displayName=c.getData().title;var n=c.NumbersStore;var f=c.AddressesStore;var g=c.EmailStore;var m=c.WebsiteStore;for(var d=0;d<n.getAllCount();d++){phoneNumber=new ContactField(n.getAt(d).get("type"),n.getAt(d).get("value"),false);b.push(phoneNumber)}myContact.phoneNumbers=b;for(var d=0;d<g.getAllCount();d++){email=new ContactField(g.getAt(d).get("type"),g.getAt(d).get("value"),false);e.push(email)}myContact.emails=e;for(var d=0;d<f.getAllCount();d++){var k=new ContactAddress();var l=f.getAt(d);var h=[];h.push(l.get("streetAddress"));if(l.get("address")){h+=", "+l.get("address")}if(l.get("address2")){h+=", "+l.get("address2")}if(l.get("address3")){h+=", "+l.get("address3")}if(l.get("address4")){h+=", "+l.get("address4")}k.streetAddress=h;k.locality=l.get("locality");k.postalCode=l.get("postalCode");k.region=l.get("region");k.country=l.get("country");a.push(k)}myContact.addresses=a;for(var d=0;d<m.getAllCount();d++){url=new ContactField(m.getAt(d).get("type"),m.getAt(d).get("value"),false);i.push(url)}myContact.urls=i;myContact.save(j.onSuccess,j.onError)},onSuccess:function(){Ext.Msg.alert("Address Book","Added to address book",Ext.emptyFn)},onError:function(){if(Ext.os.is.Android){Ext.Msg.alert("Address Book","This contact already exists in your device's contact list.",Ext.emptyFn)}else{Ext.Msg.alert("Address Book","To use this function, you have to allow this mobile application to access your contacts by changing iOS settings in Settings > Privacy > Contacts",Ext.emptyFn)}},onTellAFriend:function(){var c=Personify.utils.Configuration.getConfiguration().getAt(0).AboutStore.get("appShareTitle");var a=Personify.utils.Configuration.getConfiguration().getAt(0).AboutStore.get("appShareText");var b=Personify.utils.Configuration.getConfiguration().getAt(0).AboutStore.get("appUrl");a=a.replace("{appUrl}",b);if(window.plugins.emailComposer){window.plugins.emailComposer.showEmailComposer(c,a,null,null,null)}},onTapAddressList:function(h,c,g,b,f,d){var a=null;if(b.get("fomatted")){a=b.get("formatted").split("/n").join(", ")}else{a=Personify.utils.ItemUtil.getAddress(b)}Personify.utils.ItemUtil.showAddressOnMaps(a)},onTapApp47IdSettings:function(){this.getView().parent.hide();var a=Ext.create("Personify.view.help.Settings");Ext.Viewport.add(a);a.show()}});