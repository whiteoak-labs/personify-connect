Ext.define("Personify.controller.home.Home",{extend:"Personify.base.Controller",inject:["currentUser"],config:{currentUser:null},control:{menuHome:{onMenuItemTapped:"onMenuItemTapped"},nextThreeEventList:{onEventItemTapped:"onEventItemTapped",onViewMoreEventTap:"onViewMoreEvent",copymeetinglist:"onCopyMeetingList"},lastNewsPanel:{onViewMoreNewsTap:"onViewMoreNews"},bigEventPanel:{onEventItemTapped:"onEventItemTapped"},view:{painted:"onPainted"}},init:function(){if(window.plugins.app47){window.plugins.app47.sendGenericEvent("Home")}this.onLoadMenu();var a=Ext.create("Ext.Button",{cls:"menu-item about menu-list-item-background",text:"About",handler:function(){var b=Ext.create("Personify.view.Help");Ext.Viewport.add(b);b.show()}});this.getMenuHome().getItems().items[1].add(a)},onPainted:function(){Ext.Viewport.setMasked(false)},onLoadMenu:function(){var a=this;this.getCurrentUser().modulesConfigurationLoad("tablet",function(b){a.getMenuHome().getController().setTitle("Quick Menu");a.getMenuHome().getController().updateScrollable(true);a.getMenuHome().getController().setStore(b)})},onMenuItemTapped:function(b){if(!Personify.utils.PhoneGapHelper.checkConnection()&&b.get("name")!="Events"){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}if(b.get("name")==="Discussion"){this.openDiscussion(b);return}var a=this.getView().getParent().getParent();if(a!=null){a.getController().onRequestChangeView(b.get("view"),{record:b,listeners:b.get("listeners")},b.get("title"),b.get("css"))}else{this.getView().fireEvent("requestchangeview",b.get("view"),{record:b,listeners:b.get("listeners")},b.get("title"),b.get("css"))}},onEventItemTapped:function(d){if(window.plugins.app47){window.plugins.app47.sendGenericEvent("Event Detail")}var b=this.getView().getParent().getParent();var a=d.get("isConference");var e=d.get("shortName");var c=true;var f=a?"Personify.view.event.complexevent.ComplexEvent":"Personify.view.event.simpleEvent.SimpleEvent";if(b!=null){b.getController().onRequestChangeView(f,{record:d,listeners:{userlogin:"refresh"},fromMain:c},e,"")}else{this.getView().fireEvent("requestchangeview",f,{record:d,listeners:{userlogin:"refresh"},fromMain:c},e,"eventmenuitem")}},onViewMoreEvent:function(){var a=this.getView().getParent().getParent();if(a!=null){a.getController().openView("Personify.view.EventAndEventDetail",{listeners:{userlogin:"refresh"}},"Events","eventmenuitem")}else{this.getView().fireEvent("requestchangeview","Personify.view.EventAndEventDetail",{listeners:{userlogin:"refresh"}},"Events","eventmenuitem")}},onViewMoreNews:function(){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}var a=this.getView().getParent().getParent();if(a!=null){a.getController().openView("Personify.view.News",null,"News","newsmenuitem")}else{this.getView().fireEvent("requestchangeview","Personify.view.News",null,"News","newsmenuitem")}},onCopyMeetingList:function(b,a){this.getView().getParent().fireEvent("copymeetinglist",b,a)},openDiscussion:function(b){var a=Personify.utils.Configuration.getCurrentUser();var e=a?a.isLogged():false;if(b.get("neededLogin")&&!e){Ext.Viewport.setMasked(false);Personify.utils.ItemUtil.needToLogin();return}if(Personify.utils.Configuration.getDiscussionUrl()){var d=Personify.utils.Configuration.getDiscussionUrl();Ext.Viewport.setMasked(false);if(Ext.os.is.Android){window.open(d,"_blank","location=yes,enableViewportScale=yes")}else{window.open(d,"_blank","location=no,enableViewportScale=yes")}}else{var f=Personify.utils.Configuration.getConfiguration().getAt(0).DiscussionStore;var a=Personify.utils.Configuration.getCurrentUser();var h=Personify.utils.ServiceManager.getStoreManager();var g=Ext.create(h.getProfileAuthenticationUrl());var c={MasterCustomerId:a.get("masterCustomerId"),SubCustomerId:a.get("subCustomerId"),Username:Personify.utils.Configuration.getUserName(),Password:Personify.utils.Configuration.getPassword(),InputURL:f.get("url"),PageKey:"",VendorUserName:f.get("vendorUsername"),VendorId:f.get("vendorId"),VendorPassword:f.get("vendorPassword"),VendorBlock:f.get("vendorBlock")};g.setDataRequest(c);g.load({callback:function(j,i,l){Ext.Viewport.setMasked(false);if(j[0]){var k=j[0].get("outputUrl");Personify.utils.Configuration.setDiscussionUrl(k);if(Ext.os.is.Android){window.open(k,"_blank","location=yes,enableViewportScale=yes")}else{window.open(k,"_blank","location=no,enableViewportScale=yes")}}}})}}});