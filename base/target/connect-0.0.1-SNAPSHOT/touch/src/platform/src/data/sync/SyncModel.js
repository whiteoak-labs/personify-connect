Ext.data.SyncModel={STATE:"_state",TOMBSTONE:"_ts",OID:"_oid",REF:"_ref",MODEL:"_model",state:undefined,createReplStorageModel:function(a){var c=this.fields.items.slice(0);c=c.concat([{name:"_state"},{name:"_ts"},{name:"_oid"},{name:"_ref"},{name:"_model"}]);var b=Ext.regModel("Sencha.StorageModel."+a,{fields:c,idProperty:Ext.data.SyncModel.OID});return b},oid:function(){return this.data[Ext.data.SyncModel.OID]},ref:function(){return this.data[Ext.data.SyncModel.REF]},userData:function(){var b={};for(var a in this.data){if(a[0]!=="_"){b[a]=this.data[a]}}return b},isSystemModel:function(){var a=this.data[Ext.data.SyncModel.MODEL];return a!==undefined&&a.indexOf("Ext.data.",0)===0},changeReplicaNumber:function(a,c){this.setup();var d=false;this.forEachCS(this.state,function(g){var f=g.changeReplicaNumber(a,c);d=d||f;return g},this);var b=this.oid();if(b){var e=new Ext.data.CS(b);if(e.changeReplicaNumber(a,c)){this.data[Ext.data.SyncModel.OID]=e.to_s();d=true}}return d},setCreateState:function(b){this.state={};var a=b();this.setPair(Ext.data.SyncModel.OID,a.to_s(),a);this.forEachValue(this.data,[],function(d,c){if(d[0]!==Ext.data.SyncModel.OID){this.setCS(d,b())}},this)},setUpdateState:function(c){var b=this.getChanges(),a;for(a in b){if(a!==Ext.data.SyncModel.STATE&&a!==Ext.data.SyncModel.OID){this.setUpdateStateValue([a],this.modified[a],b[a],c)}}},setUpdateStateValue:function(g,b,f,e){if(this.isComplexValueType(f)){if(b){var c={};if(this.isComplexValueType(b)){if(this.valueType(b)===this.valueType(f)){c=Ext.data.utilities.minus(f,b);var h=Ext.data.utilities.intersection(f,b);for(var d in h){if(h.hasOwnProperty(d)){if(b[d]!==f[d]){c[d]=f[d]}}}}else{c=f;this.setCS(g,e())}}else{c=f;this.setCS(g,e())}}else{c=f;this.setCS(g,e())}for(var d in c){if(c.hasOwnProperty(d)){var a=b?b[d]:undefined;this.setUpdateStateValue(g.concat(d),a,f[d],e)}}}else{this.setCS(g,e())}},setDestroyState:function(b){var a=b();this.data[Ext.data.SyncModel.TOMBSTONE]=a.to_s();this.setCS(Ext.data.SyncModel.TOMBSTONE,a)},isNotDestroyed:function(){var a=this.data[Ext.data.SyncModel.TOMBSTONE];return(a===undefined||a==="")},getUpdates:function(a){this.setup();var c=[];var b=this.oid();this.forEachPair(this.data,this.state,[],[],function(g,d,f){if(f){var e=a.get(f);if(!e||e.lessThan(f)){c.push({i:b,p:g.length==1?g[0]:g,v:d.length==1?d[0]:d,c:f})}}},this);return c},putUpdate:function(a){return this.setPair(a.p,a.v,a.c)},equals:function(a){this.forEachPair(this.data,this.state,[],[],function(f,b,c){var e=a.getPair(f);var d=b[b.length-1];if(!(c.equals(a.c)&&d===a.v)){return false}},this);return true},forEachPair:function(e,a,m,h,j,k){this.setup();for(var b in a){if(a.hasOwnProperty(b)){var c=a[b];var f=e[b];var d=m.concat(b);var i=this.valueType(f);var g;switch(i){case"object":g={};break;case"array":g=[[]];break;default:g=f}var l=h.concat(g);switch(this.valueType(c)){case"string":j.call(k,d,l,new Ext.data.CS(c));break;case"array":switch(i){case"undefined":console.log("Warning - There was no data for the state at path",d);console.log("Warning -",Ext.encode(this.data));break;case"object":case"array":j.call(k,d,l,new Ext.data.CS(c[0]));this.forEachPair(f,c[1],d,l,j,k);break;default:j.call(k,d,l,new Ext.data.CS(c[0]));break}break}}}},forEachValue:function(c,e,g,b){var f,a;for(f in c){if(c.hasOwnProperty(f)){a=c[f];if(a!==this.state){var d=e.concat(f);g.call(b,d,a);if(this.isComplexValueType(a)){this.forEachValue(a,d,g,b)}}}}},getCSV:function(){var a=new Ext.data.CSV();this.forEachCS(this.state,function(b){a.add(b)},this);return a},forEachCS:function(d,f,c){var a,e,b;for(a in d){if(d.hasOwnProperty(a)){e=d[a];switch(this.valueType(e)){case"string":b=f.call(c,new Ext.data.CS(e));if(b){d[a]=b.to_s()}break;case"array":b=f.call(c,new Ext.data.CS(e[0]));if(b){d[a][0]=b.to_s()}this.forEachCS(e[1],f,c);break}}}},getCS:function(g){this.setup();var d=this.state;if(Ext.isArray(g)){var a=g.length;var f=a-1;for(var c=0;c<a;c++){var b=g[c];if(c===f){return this.do_getCS(d,b)}else{d=this.do_getState(d,b)}}}else{return this.do_getCS(d,g)}},do_getCS:function(c,a){var b=undefined;c=c[a];if(c){switch(this.valueType(c)){case"string":b=new Ext.data.CS(c);break;case"array":b=new Ext.data.CS(c[0]);break;default:console.log("Error - SyncModel - do_getCS - unexpected type in state for",a,":",typeof c,c);console.log("state",Ext.encode(this.data));b=new Ext.data.CS();break}}return b},setCS:function(h,d){this.setup();var f=this.state;if(Ext.isArray(h)){var a=h.length;var g=a-1;for(var c=0;c<a;c++){var b=h[c];if(c===g){this.do_setCS(f,b,d)}else{f=this.do_getState(f,b)}}}else{this.do_setCS(f,h,d)}},do_setCS:function(d,b,c){var e=(c instanceof Ext.data.CS)?c.to_s():c;var a=d[b];if(a){switch(this.valueType(a)){case"string":d[b]=e;break;case"array":a[0]=e;break;default:console.log("Error - SyncModel - do_setCS - unexpected type in state for",b,":",typeof a,a);console.log("state",Ext.encode(d));console.log("name",b,"cs",e);d[b]=e}}else{d[b]=e}},getPair:function(h){this.setup();var f=this.data;var d=this.state;if(Ext.isArray(h)){var a=h.length;var g=a-1;for(var c=0;c<a;c++){var b=h[c];if(c===g){return{v:f?f[b]:f,c:this.do_getCS(d,b)}}else{d=this.do_getState(d,b);f=f?f[b]:f}}}else{return{v:f[h],c:this.do_getCS(d,h)}}},setPair:function(s,r,d){var k=false;this.setup();if(!Ext.isArray(s)){s=[s];r=[r]}var m=this.data;var c=this.state;var f=s.length;var n=f-1;for(var j=0;j<f;j++){var b=s[j];var q=r[j];var p=this.do_getCS(c,b);var o=m[b];var h=this.valueType(o);var g=this.valueType(q);var a=((h==="object"&&g==="object")||(h==="array"&&g==="array"));if(p){if(d.greaterThan(p)){if(a){q=undefined}if(this.do_setPair(m,c,b,q,d)){k=true}}else{if(a){}else{return k}}}else{if(this.do_setPair(m,c,b,q,d)){k=true}}if(j!==n){m=this.do_getData(m,b);c=this.do_getState(c,b,d)}}return k},do_getState:function(d,a,c){var e=d[a];switch(this.valueType(e)){case"undefined":var b={};d[a]=[c,b];d=b;break;case"string":var b={};d[a]=[e,b];d=b;break;case"array":d=e[1];break;default:throw"Error - SyncModel - do_getState - unexpected type in state: "+(typeof e)+" "+e}return d},do_setPair:function(d,c,a,b,e){var f=false;if(b!==undefined){this.do_setData(d,a,b);f=true}if(e!==undefined){this.do_setCS(c,a,e);f=true}return f},do_getData:function(b,a){return b[a]},do_setData:function(c,a,b){c[a]=b},valueType:function(b){var a=typeof b;if(a==="object"&&(b instanceof Array)){a="array"}return a},valueEquals:function(e,d){var c=false;var b=this.valueType(e);var a=this.valueType(d);if(b===a){switch(b){case"object":case"array":c=Ext.encode(e)===Ext.encode(d);break;default:c=e===d}}return c},isComplexValueType:function(a){return(typeof a==="object")},setup:function(){this.data[Ext.data.SyncModel.STATE]=this.data[Ext.data.SyncModel.STATE]||{};this.state=this.data[Ext.data.SyncModel.STATE]}};