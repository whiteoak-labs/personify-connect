Ext.define("Ext.Promise",{statics:{when:function(){var c=new this,e=Array.prototype.slice.call(arguments),b=-1,d=[],g;function a(h){c.reject(h)}function f(h){g=e.shift();if(b>=0){d[b]=h}b++;if(g){g.then(f,a)}else{c.fulfill.apply(c,d)}}f();return c},whenComplete:function(g){var f=new this,e=-1,h=[],c=[],i;function a(j){i=g.shift();c.push(j);d(i)}function b(j){i=g.shift();h.push(j);d(i)}function d(j){e++;if(j){j.then(b,a)}else{f.fulfill.call(f,{fulfilled:h,rejected:c})}}d(g.shift());return f},from:function(){var a=new this;a.completed=1;a.lastResults=arguments;return a},fail:function(a){var b=new this;b.completed=-1;b.lastReason=a;return b}},completed:0,getListeners:function(b){var a=this.listeners;if(!a&&b){this.listeners=a=[]}return a},then:function(b,c,a){if(typeof b=="function"){a=c;c=b;b=null}if(typeof c=="string"){c=b[c]}if(typeof a=="string"){a=b[a]}return this.doThen(b,c,a)},doThen:function(d,g,b){var e=Ext.Promise,c=this.completed,f,a;if(c===-1){if(b){b.call(d,this.lastReason)}return this}if(c===1&&!this.isFulfilling){if(!g){return this}a=g.apply(d,this.lastResults);if(a instanceof e){f=a}else{f=e.from(a)}}else{f=new e;f.$owner=this;this.getListeners(true).push({scope:d,success:g,error:b,promise:f})}return f},error:function(b,a){if(typeof b=="function"){a=b;b=null}if(typeof a=="string"){a=b[a]}return this.doThen(b,null,a)},fulfill:function(){var b=arguments,d,e,c,g,f,a;this.lastResults=b;this.completed=1;while(d=this.getListeners()){delete this.listeners;this.isFulfilling=true;while(e=d.shift()){g=e.success;c=e.scope;f=e.promise;delete f.$owner;if(g){a=g.apply(c,b);if(a instanceof Ext.Promise){a.connect(f)}else{f.fulfill(a)}}else{f.fulfill(b)}}this.isFulfilling=false}return this},connect:function(b){var a=this;a.then(b,function(c){this.fulfill(c);return c},"reject")},reject:function(d){var b=this.getListeners(),c,a,e;this.lastReason=d;this.completed=-1;if(b){delete this.listeners;while(c=b.shift()){a=c.error;e=c.promise;delete e.$owner;if(a){a.call(c.scope,d)}e.reject(d)}}return this},cancel:function(){var c=this.getListeners(),a=this.$owner,b,d,e;if(c){for(b=0,d=c.length;b<d;b++){e=c[b];e.promise.cancel()}c.length=0;delete this.listeners}if(a){delete this.$owner;a.cancel()}}});