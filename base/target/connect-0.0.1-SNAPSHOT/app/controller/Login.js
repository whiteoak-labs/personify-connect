Ext.define("Personify.controller.Login",{extend:"Personify.base.Controller",inject:{allProductStore:"allProductStore"},config:{allProductStore:null},control:{loginForm:{loginsuccess:"onLoginSuccess",forgotPassword:"onForgotPassword"},loginstatus:{},loginButton:{tap:"onLoginButtonTap",submitLogin:"onLoginButtonTap"},profileButton:{tap:"onProfileButtonTap"}},init:function(){var a=Personify.utils.Configuration.getCurrentUser();if(a.isLogged()){this.onLoginSuccess(a)}},resetViews:function(){this.getLoginForm().hide();this.getLoginButton().show();this.getProfileButton().hide()},callbackFn:function(b,a){return function(){a.apply(b,arguments)}},onOnLine:function(){var a=this,b=a.getView();b.setHidden(false)},onOffLine:function(){var a=this,b=a.getView();b.setHidden(true)},onLoginSuccess:function(b){var e=this;e.getAllProductStore().removeAll();Personify.utils.Configuration.setCurrentUser(b);e.getView().fireEvent("userlogin",b);var d=e.getLoginButton(),f=e.getLoginForm(),c=e.getProfileButton();if(window.plugins.pushNotification){var a=window.plugins.pushNotification;a.setAlias(b.data.userKey)}f.hide();d.setHidden(true);c.setHidden(false)},onLoginButtonTap:function(b){if(Personify.utils.Configuration.getAllowChangeView()){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}Ext.Viewport.setMasked(false);if(window.plugins.app47){window.plugins.app47.sendGenericEvent("Login")}var c=this;var d=c.getLoginForm(),a=c.getLoginstatus();d.showBy(b,"tr-tr");if(window.plugins.applicationPreferences){window.plugins.applicationPreferences.get("checked",function(e){if(e=="1"){var f=d.getController();window.plugins.applicationPreferences.get("username",function(g){f.getUsernameTextfield().setValue(g)},function(){});window.plugins.applicationPreferences.get("password",function(g){f.getPasswordTextfield().setValue(g)},function(){})}},function(){})}}else{Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn)}},onProfileButtonTap:function(){if(Personify.utils.Configuration.getAllowChangeView()){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}Ext.Viewport.setMasked({xtype:"loadmask"});this.getView().fireEvent("requestchangeview","Personify.view.Profile",null,"Profile","profilemenuitem");this.getView().fireEvent("hideShoppingCart")}else{Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn)}},onForgotPassword:function(){var a=this,b=a.getLoginForm();b.hide()}});