Ext.define("Personify.controller.phone.menubar.MenuBar",{extend:"Personify.base.Controller",inject:["currentUser"],requires:["Personify.view.phone.aboutAPA.AboutAPAPhone","Personify.view.phone.notification.PanelNotificationPhone"],config:{currentUser:null},control:{topMenubarButton:{onTapInfoButtonOnPhoneMenu:"onTapInfoButtonOnPhoneMenu",onmenutap:"onOpenMenuBar",onTapButtonNotificationPhone:"onTapButtonNotificationPhone",onTapButtonShoppingCartPhone:"onTapButtonShoppingCartPhone"},bottomMenuButton:{onTapInfoButtonOnPhoneMenu:"onTapInfoButtonOnPhoneMenu",onmenutap:"onCloseMenuBar",onTapButtonNotificationPhone:"onTapButtonNotificationPhone",onTapButtonShoppingCartPhone:"onTapButtonShoppingCartPhone"},menubarListItems:{openmainview:"openMainPage",openinfopage:"openInfoPage",onmenuitem:"onMenuItemTap"},expandedMenu:true},init:function(){var b=this;this.callParent(arguments);var a=this.getCurrentUser();a.modulesConfigurationLoad("phone",function(c){b.updateMenuList(c)})},destroy:function(){this.getBottomMenuButton().setShowAnimation(null);this.getExpandedMenu().setShowAnimation(null);this.getExpandedMenu().setHideAnimation(null);return this.callParent(arguments)},updateMenuList:function(b){var e=false;var a=b.getData().all;for(var c=0,d=a.length;c<d;c++){if(a[c].get("view")=="Personify.view.phone.store.Store"){e=true;break}}this.getTopMenubarButton().getController().setEnableShoppingCart(e);this.getBottomMenuButton().getController().setEnableShoppingCart(e);this.getMenubarListItems().getController().setMenuStore(b);this.getView().setActiveItem(0)},openInfoPage:function(){this.getView().fireEvent("requestchangeview","Personify.view.phone.aboutAPA.AboutAPAPhone",null);this.resetSelectedButton();this.getMenubarListItems().getController().selectBtn("info")},openMainPage:function(){this.getView().fireEvent("backtomain");this.resetSelectedButton();this.getMenubarListItems().getController().selectBtn("main")},resetSelectedButton:function(){this.onCloseMenuBar();this.getMenubarListItems().getController().resetSelectedButton()},onMenuItemTap:function(a){var b=this;b.onCloseMenuBar();if(!Personify.utils.PhoneGapHelper.checkConnection()&&a.get("name")!="Events"){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}Ext.callback(function(){b.getView().fireEvent("requestchangeview",a.get("view"),{record:a})},b,[],1)},onOpenMenuBar:function(){this.getView().setHeight(115);this.getView().setActiveItem(1);this.getMenubarListItems().show()},onCloseMenuBar:function(){Ext.callback(this.closeMenuBar,this,[],400)},closeMenuBar:function(){this.getView().setHeight(51);this.getView().setActiveItem(0)},setTextButtonNotificationPhone:function(a){if(a!=""||a!=null){this.getTopMenubarButton().getController().setTextButtonNotificationPhone(""+a);this.getBottomMenuButton().getController().setTextButtonNotificationPhone(""+a)}},setTextButtonShoppingCartPhone:function(a){if(a!=""||a!=null){this.getTopMenubarButton().getController().setTextButtonShoppingCartPhone(""+a);this.getBottomMenuButton().getController().setTextButtonShoppingCartPhone(""+a)}},onTapButtonNotificationPhone:function(){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}var a=Personify.utils.Configuration.getCurrentUser();if(a.isLogged()){this.getView().fireEvent("requestchangeview","Personify.view.phone.notification.PanelNotificationPhone",null);this.resetSelectedButton();this.disableButtonNotificationPhone(true)}else{Ext.Viewport.setMasked(false);Personify.utils.ItemUtil.needToLogin();return}},disableButtonNotificationPhone:function(a){if(a!=""||a!=null){this.getTopMenubarButton().getController().disableButtonNotificationPhone(a);this.getBottomMenuButton().getController().disableButtonNotificationPhone(a)}},onTapInfoButtonOnPhoneMenu:function(){this.getView().fireEvent("requestchangeview","Personify.view.phone.aboutAPA.AboutAPAPhone",null);this.resetSelectedButton()},onTapButtonShoppingCartPhone:function(){var a=Personify.utils.Configuration.getCurrentUser();if(a&&a.isLogged()){this.getView().fireEvent("checkoutshoppingcart",this)}else{var b=Ext.create("Personify.view.phone.login.LoginPhone");b.addListener("updatecurrentuser",this.onUpdateCurrentUser,this);this.getView().fireEvent("requestchangeview",b,null)}}});