Ext.define("Personify.controller.phone.schedule.PersonalAgenda",{extend:"Personify.base.Controller",control:{eventToolbar:{onNavigationButtonTap:"onBack"},titleOfEvent:true,description:true,location:true,timeDisplay:true,numberOfDate:true,monthAndYear:true,deleteAgendaButton:{tap:"onDeleteAgendaButtonTap"}},init:function(){this.getEventToolbar().getController().setHiddenActionButton(true);var a=this.getView().getRecord();this.setRecord(a)},setRecord:function(b){if(b){var a=Personify.utils.ItemUtil;var c=Ext.Date.format(b.get("startDateTime"),"j")+'<sup class= "p-phone-itemlist-eventday-ordinalsuffix">'+Ext.Date.format(b.get("startDateTime"),"S")+"</sup>";this.getNumberOfDate().setHtml(c);this.getMonthAndYear().setHtml(Ext.Date.format(b.get("startDateTime"),"M Y"));this.getTimeDisplay().setHtml(a.getDisplayTimeForEvent(b.get("startDateTimeString"),b.get("endDateTimeString")));this.getTitleOfEvent().setHtml(b.get("title"));this.getLocation().setHtml(b.get("location"));this.getDescription().setHtml(b.get("description"))}},onBack:function(){var a=this;thisView=a.getView();thisView.fireEvent("back",this)},onDeleteAgendaButtonTap:function(){var d=this;var a=this.getView().getRecord();if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}var a=this.getView().getRecord();var c=Personify.utils.ItemUtil.getMessageMatchTypeOfEvent(a);Ext.Msg.confirm("",c.msg,b);function b(e){Ext.Msg.hide();if(e=="yes"){Ext.Viewport.setMasked({xtype:"loadmask"});d.getView().fireEvent("removeagenda",d.getView().getRecord(),function(f){if(f){Ext.Viewport.setMasked(false);Ext.Msg.alert("",c.msgSuccess,Ext.emptyFn)}d.getView().fireEvent("refreshagenda",d.getView().getRecord(),false)})}}}});