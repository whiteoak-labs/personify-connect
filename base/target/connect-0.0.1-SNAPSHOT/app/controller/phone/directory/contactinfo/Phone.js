Ext.define("Personify.controller.phone.directory.contactinfo.Phone",{extend:"Personify.controller.profile.Phone",requires:["Personify.view.phone.directory.contactinfo.PhoneList","Personify.view.phone.directory.contactinfo.PhoneEditForm"],config:{countryListStore:null,typeList:null,typeListToRemove:null,recordsForDelete:new Array(),errorMessage:"\n- Wrong phone format:",blankErrorMessage:"- Phone field cannot be empty",primaryAddressCountry:null,canAddMoreFlag:null},control:{infoContainer:{typelistchange:"onTypeListChange",textboxchange:"onTextboxChange",deleteCommand:"onDeleteCommand"}},updateEditMode:function(f,g){var e=this;e.getView().setHidden(false);if(g){e.setCountryListStore(g)}var c=e.getInfoContainer();c.removeAll(true,true);if(f==true){var h=new Array(),d=e.getView().getRecord();e.setTypeList(d.get("communicationLocationList").split(","));var b=d.EntryProfile.getAt(0).AddressesProfile;if(b){b.each(function(i){if(i.get("primary")&&i.get("primary")==true){e.setPrimaryAddressCountry(i.get("country"))}})}var a=d.EntryProfile.getAt(0).PhoneNumbersProfile;a.each(function(i){var j=Ext.create("Personify.view.phone.directory.contactinfo.PhoneEditForm");j.getController().hideCountryList(false,g);j.getController().setTypeList(e.getTypeList());j.setRecord(i);c.add(j);h.push(i.get("type"))});e.setTypeListToRemove(h);e.addEmptyItem();e.updateTypeListForAllEditItems()}else{e.setRecord(e.getView().getRecord())}},addEmptyItem:function(){var c=this.checkTypeList();if(c.length==0){this.setCanAddMoreFlag(false);return}else{this.setCanAddMoreFlag(true)}var b=this.getInfoContainer();var d=Ext.create("Personify.view.phone.directory.contactinfo.PhoneEditForm");d.getController().hideCountryList(false,this.getCountryListStore());d.getController().setTypeList(c);this.getTypeListToRemove().push(c[0]);b.add(d);var a=this.getPrimaryAddressCountry();if(a){d.getController().setCountryForEmptyItem(a)}},setRecord:function(a){if(a){if(this.getIsEditing()){this.updateEditMode(true,this.getCountryListStore());return}if(a.EntryProfile.getAt(0).PhoneNumbersProfile.getCount()>0){this.getInfoContainer().removeAll(true,true);var b=Ext.create("Personify.view.phone.directory.contactinfo.PhoneList",{scrollable:null,disableSelection:true});b.setStore(a.EntryProfile.getAt(0).PhoneNumbersProfile);this.getInfoContainer().add(b);this.getView().setHidden(false)}else{this.getView().setHidden(true)}}}});