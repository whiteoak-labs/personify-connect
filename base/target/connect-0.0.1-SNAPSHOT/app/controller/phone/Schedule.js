Ext.define("Personify.controller.phone.Schedule",{extend:"Personify.base.Controller",control:{scheduleNavigationView:true,myschedulePanel:{live:true,listeners:{requestopendetail:"openView",backtomain:"onBackToMain",removeagenda:"onRemoveAgenda",requestchangeview:"onRequestChangeView"}}},onLoadData:function(){this.getMyschedulePanel().getController().onGetData()},openView:function(b,c){if(typeof b=="string"){b=Ext.create(b,c)}b.addListener("back",this.onBack,this);b.addListener("backtomain",this.onBackToMain,this);b.addListener("requestchangeview",this.onRequestChangeView,this);b.addListener("requestopendetail",this.openView,this);b.addListener("removeagenda",this.onRemoveAgenda,this);b.addListener("addagenda",this.onAddAgenda,this);b.addListener("refreshagenda",this.onRefreshAgenda,this);if(c){var d=c.record.get("listeners");if(d){for(var e in d){this.getView().addListener(e,d[e],b)}}}var a=this.getScheduleNavigationView();if(a.getActiveItem().xtype!=b.xtype){a.push(b)}},onRequestChangeView:function(a,b){this.getView().fireEvent("requestchangeview",a,b)},onBack:function(){var f=this,a=f.getScheduleNavigationView();a.pop();if(!a.getActiveItem().getController()["getExpandEvent"]){return}var g=a.getActiveItem().getController(),d=g.getExpandEvent(),b=g.getEventRecord(),c=0;g.setFlagSelected(false);g.setItemSelected(false);if(d!=null){for(var e in b){if(c===d){Ext.Viewport.setMasked({xtype:"loadmask",message:"Loading..."});setTimeout(function(){if(Ext.get(g.getSelectScheduleItem().getViewItems()[c].id.trim()).down(".p-filter-button-new")){g.getSelectScheduleItem().select(b[e])}Ext.Viewport.setMasked(false)},100);break}c++}}},onRefreshAgenda:function(c,f,g){var e=this,a=e.getScheduleNavigationView(),d=a.getInnerItems().length;if(d>1){a.popToRoot()}var b=a.getActiveItem();if(b.getItemId()=="myschedulePanel"){this.getView().fireEvent("refreshagenda",function(j,h,i){b.getController().addOrRemoveByMeetingRecord(c,f,i);if(typeof g==="function"){g(j,null,true)}})}},onBackToMain:function(){this.getView().fireEvent("backtomain")},onRemoveAgenda:function(a,c){var b=this;this.getView().fireEvent("removeagenda",a,function(f,d,e){b.getMyschedulePanel().getController().addOrRemoveByMeetingRecord(a,false,e);c(f)})},onAddAgenda:function(a,b,d){var c=this;this.getView().fireEvent("addagenda",a,b,function(g,e,f){c.getMyschedulePanel().getController().addOrRemoveByMeetingRecord(a,true,f);d(g,e)})}});