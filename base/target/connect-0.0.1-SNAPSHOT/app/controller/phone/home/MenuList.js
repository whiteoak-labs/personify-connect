Ext.define("Personify.controller.phone.home.MenuList",{extend:"Personify.base.Controller",inject:["currentUser"],config:{currentUser:null},control:{view:{itemtap:"onItemTap"}},init:function(){this.onUpdateCurrentUser(this.getCurrentUser())},onUpdateCurrentUser:function(a){var b=this;this.setCurrentUser(a);a.modulesConfigurationLoad("phone",function(c){b.getView().setStore(c)})},onItemTap:function(d,b,e,a){if(a.get("name")==="Discussion"){this.openDiscussion(a)}else{var c=this;thisView=c.getView();Ext.callback(function(){thisView.getParent().getParent().getParent().fireEvent("requestchangeview",a.get("view"),{record:a})},c,[],1)}},openDiscussion:function(h){var f=Personify.utils.Configuration.getCurrentUser();var c=f?f.isLogged():false;if(h.get("neededLogin")&&!c){Ext.Viewport.setMasked(false);Personify.utils.ItemUtil.needToLogin();return}var i=this;if(Personify.utils.Configuration.getDiscussionUrl()){var b=Personify.utils.Configuration.getDiscussionUrl();if(Ext.os.is.Android){window.open(b,"_blank","location=yes,enableViewportScale=yes")}else{window.open(b,"_blank","location=no,enableViewportScale=yes")}}else{var e=Personify.utils.Configuration.getConfiguration().getAt(0).DiscussionStore;var a=Personify.utils.ServiceManager.getStoreManager();var d=Ext.create(a.getProfileAuthenticationUrl());var g={MasterCustomerId:f.get("masterCustomerId"),SubCustomerId:f.get("subCustomerId"),Username:Personify.utils.Configuration.getUserName(),Password:Personify.utils.Configuration.getPassword(),InputURL:e.get("url"),PageKey:"",VendorUserName:e.get("vendorUsername"),VendorId:e.get("vendorId"),VendorPassword:e.get("vendorPassword"),VendorBlock:e.get("vendorBlock")};d.setDataRequest(g);this.getView().setMasked({xtype:"loadmask"});d.load({callback:function(k,j,m){i.getView().setMasked(false);if(k[0]){var l=k[0].get("outputUrl");Personify.utils.Configuration.setDiscussionUrl(l);if(Ext.os.is.Android){window.open(l,"_blank","location=yes,enableViewportScale=yes")}else{window.open(l,"_blank","location=no,enableViewportScale=yes")}}}})}}});