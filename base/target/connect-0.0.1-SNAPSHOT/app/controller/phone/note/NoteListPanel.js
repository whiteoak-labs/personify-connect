Ext.define("Personify.controller.phone.note.NoteListPanel",{extend:"Personify.base.Controller",control:{eventToolbar:{onNavigationButtonTap:"onBack",actionButtonTap:"onAddNewNoteButtonTap"},noteList:{itemtap:"onItemTapNoteList"},shareAllNote:{tap:"onTapShareAllNote"},noteTitleBar:true},init:function(){this.getEventToolbar().getController().setActionText("+ Add");var a=this.getView().getTitle();if(a){this.getNoteTitleBar().setHtml(Personify.utils.ItemUtil.getShortContent(a,48))}},setRecord:function(a){var b="";if(a.get("shortName")){b=a.get("shortName")}else{if(a.get("title")){b=a.get("title")}}this.getNoteTitleBar().setHtml(Personify.utils.ItemUtil.getShortContent(b,48))},updateListNote:function(a,b){if(a){this.getNoteList().setStore(a);if(b){if(a.getCount()>0){this.getEventToolbar().updateHiddenActionButton(true)}else{this.getEventToolbar().updateHiddenActionButton(false)}}}},onItemTapNoteList:function(h,d,f,c,g,i){var k=this;var a=k.getView().getEventId();var b=k.getView().getSessionId();if(g.target.className.indexOf("x-button")>=0){Ext.Msg.confirm("","Are you sure you want to delete the Note",j);function j(e){Ext.Msg.hide();if(e=="yes"){Ext.Viewport.setMasked({xtype:"loadmask"});Personify.utils.Sqlite.deleteMyNote(c.get("noteId"),function(o){Ext.Viewport.setMasked(false);if(o){var n={eventId:a,sessionId:b};var p=Personify.utils.ServiceManager.getStoreManager();var m=Ext.create(p.getNoteListStore());m.setDataRequest(n);Ext.Viewport.setMasked({xtype:"loadmask"});m.load({callback:function(r,q,s){Ext.Viewport.setMasked(false);k.getNoteList().setStore(m);if(r.length==0){k.onAddNewNoteButtonTap()}Ext.Msg.alert("","Note has been deleted.",Ext.emptyFn)}})}else{Ext.Msg.alert("","Delete Note Failed.",Ext.emptyFn)}})}}}else{var l=this.getView().getTitle();this.getView().fireEvent("requestopendetail","Personify.view.phone.note.AddNote",{record:c,eventId:a,sessionId:b,title:l,isNoteList:true})}},onTapShareAllNote:function(){var a=this;if(window.plugins.social&&window.plugins.social.available){window.plugins.social.available(function(c){if(c==1){var b=a.getNoteList().getStore();var g="";for(var e=0;e<b.getAllCount();e++){var d=b.getAt(e);var h=d.get("title");var f=d.get("description");g+="Title: "+h+"\nNote: "+f+"\n\n"}window.plugins.social.share(g,"","")}else{target.addCls("x-item-pressed");Ext.Msg.alert("","Social network plugins is not supported.",Ext.emptyFn)}})}},onAddNewNoteButtonTap:function(){var a=this.getView().getEventId();var b=this.getView().getTitle();this.getView().fireEvent("requestopendetail","Personify.view.phone.note.AddNote",{eventId:a,title:b,isAddNew:true,isNoteList:true})},onBack:function(){this.getView().fireEvent("backtomenu",this)}});