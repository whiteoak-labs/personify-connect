Ext.define("Personify.controller.phone.note.ViewNote",{extend:"Personify.base.Controller",control:{eventToolbar:{onNavigationButtonTap:"onBack",actionButtonTap:"onAddNewNoteButtonTap"},deleteNoteButton:{tap:"onDeleteNote"},shareCurrentButton:{tap:"onShareCurrentNote"},addNotePanel:{},inputTitleNote:{},inputDescriptionNote:{}},init:function(){this.getEventToolbar().getController().setActionText("+ Add");var a=this.getView().getRecord();this.setRecord(a);this.getEventToolbar().updateHiddenActionButton(true)},setRecord:function(a){if(a){var e=a.get("title")||a.get("shortName");var c=a.get("description");if(this.getView().getIsAddNew()){c=null}var b=this.getView().getEventId();var d=this.getView().getSessionId();this.getAddNotePanel().getController().setContent(e,c);this.getAddNotePanel().setRecord(a);this.getAddNotePanel().setEventId(b);this.getAddNotePanel().setSessionId(d)}},onShareCurrentNote:function(){if(Personify.utils.Configuration.getAllowChangeView()){var a=this;if(window.plugins.social&&window.plugins.social.available){window.plugins.social.available(function(b){if(b==1){var e=a.getInputTitleNote().getValue()||"";var d=a.getInputDescriptionNote().getValue()||"";var c="Title: "+e+"\nNote: "+d+"\n";window.plugins.social.share(c,"","")}else{Ext.Msg.alert("","Social network plugins is not supported.",Ext.emptyFn)}})}}else{Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn)}},onDeleteNote:function(){if(Personify.utils.Configuration.getAllowChangeView()){var a=this.getView().getRecord();var c=this.getView().getEventId();var e=this.getView().getSessionId();var d=this;Ext.Msg.confirm("","Are you sure you want to delete the Note",b);function b(f){Ext.Msg.hide();if(f=="yes"){if(a){Ext.Viewport.setMasked({xtype:"loadmask"});Personify.utils.Sqlite.deleteMyNote(a.get("noteId"),function(i){Ext.Viewport.setMasked(false);if(i){var h={eventId:c,sessionId:e};var j=Personify.utils.ServiceManager.getStoreManager();var g=Ext.create(j.getNoteListStore());g.setDataRequest(h);Ext.Viewport.setMasked({xtype:"loadmask"});g.load({callback:function(l,k,m){Ext.Viewport.setMasked(false);Ext.Msg.alert("","Note has been deleted.",Ext.emptyFn);d.getView().fireEvent("requestopendetail","Personify.view.phone.note.NoteListPanel",{record:a,eventId:c,sessionId:e,store:g})}})}else{Ext.Msg.alert("","Delete Note Failed.",Ext.emptyFn)}})}}}}else{Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn)}},onAddNewNoteButtonTap:function(){if(Personify.utils.Configuration.getAllowChangeView()){this.getAddNotePanel().getController().onAutoSaveNote();this.getAddNotePanel().getController().onClearTextFields();this.getView().fireEvent("back",this)}else{Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn)}},onBack:function(){if(Personify.utils.Configuration.getAllowChangeView()){this.getAddNotePanel().getController().onAutoSaveNote();this.getView().fireEvent("back",this)}else{Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn)}}});