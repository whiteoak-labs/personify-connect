Ext.define("Personify.controller.phone.note.NoteNavigation",{extend:"Personify.base.Controller",config:{listNote:null},control:{noteNavigationView:true,addNotePanel:{live:true,listeners:{backtomenu:"onBackMenu",back:"onBack"}},noteListPanel:{live:true,listeners:{backtomenu:"onBackMenu",requestopendetail:"openView"}}},init:function(){var b=this.getView().getEventId();var e=this.getView().getSessionId();if(e){var d=Ext.create("Personify.view.phone.note.AddNote",{xtype:"addnotepanelphone"});d.setItemId("addNotePanel");d.setEventId(b);d.setSessionId(e);this.openView(d,null)}else{var c=this.getView().getRecord();var a=c.get("shortName");var f=Ext.create("Personify.view.phone.note.NoteListPanel",{xtype:"notelistpanelphone",itemId:"noteListPanel",eventId:b,title:a});this.openView(f,null)}this.loadNoteList()},openView:function(a,b){if(typeof a=="string"){a=Ext.create(a,b)}a.addListener("back",this.onBack,this);a.addListener("backtomenu",this.onBackMenu,this);a.addListener("requestopendetail",this.openView,this);a.addListener("addnewnote",this.addNewNote,this);if(b&&b.record){var c=b.record.get("listeners");if(c){for(var d in c){this.getView().addListener(d,c[d],a)}}}this.getView().fireEvent("updatelistnote");var e=this.getNoteNavigationView();if(!e.getActiveItem()||e.getActiveItem().xtype!=a.xtype){e.push(a)}},onRequestChangeView:function(a,b){this.getView().fireEvent("requestchangeview",a,b)},onBackMenu:function(){this.getView().fireEvent("updatelistnote",this);this.getView().fireEvent("back",this)},onBack:function(){this.loadNoteList();this.getNoteNavigationView().pop()},addNewNote:function(){this.onBack();var a=this.getView().getRecord();var b=this.getView().getEventId();var c=this.getView().getSessionId();this.openView("Personify.view.phone.note.ViewNote",{record:a,eventId:b,sessionId:c})},loadNoteList:function(){var d=this;var c=this.getView().getEventId();var e=this.getView().getSessionId();var b={eventId:c,sessionId:e};var f=Personify.utils.ServiceManager.getStoreManager();var a=Ext.create(f.getNoteListStore());a.setDataRequest(b);a.load({callback:function(i,h,k){if(e){var g=d.getView().getRecord();var j=d.getView().getTitle()||g.get("shortName");d.getAddNotePanel().setTitle(j);if(i[0]){d.getAddNotePanel().setRecord(i[0]);d.getAddNotePanel().getController().hiddenDeleteNoteButton(false)}else{d.getAddNotePanel().getController().setNoteTitle(j);d.getAddNotePanel().getController().hiddenDeleteNoteButton(true)}}else{d.getNoteListPanel().setStore(a)}}})}});