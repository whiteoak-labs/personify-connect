Ext.define("Personify.controller.Exhibitor",{extend:"Personify.base.Controller",control:{segmentedbutton:true,segmentButtonAllExhibitor:{tap:"onTapSegBtnAllEx"},segmentButtonMyExhibitor:{tap:"onTapSegBtnMyEx"},panelExhibitorList:{onexhibitortap:"ontapAllExhibitorItem"},allExhibitorList:{updateExhibitorStore:"updateExhibitorStore",updateAddMyScheduleButton:"updateAddMyScheduleButton"},myExhibitorList:{updateExhibitorStore:"updateExhibitorStore"}},config:{exhibitorStore:null},init:function(){if(window.plugins.app47){window.plugins.app47.sendGenericEvent("Exhibitor List")}},setRecord:function(b){var c=this;var a=this.getView();if(a&&!a.isDestroyed){this.getAllExhibitorList().setRecord(b);this.getMyExhibitorList().setRecord(b);this.getView().setRecord(b);if(b){if(b.ExhibitorStore){this.setExhibitorStore(b.ExhibitorStore);this.getAllExhibitorFromSql(b,function(d){c.setExhibitorData(d)})}else{this.onGetData(b)}}}},setExhibitorData:function(b){this.getAllExhibitorList().setStore(b);var d=Personify.utils.ServiceManager.getStoreManager(),a=d.getExhibitorStore(),c=Ext.create(a);b.each(function(e){c.add(e)});this.getMyExhibitorList().setStore(c)},onGetData:function(b){var d=this,e={ItemsPerPage:"10",XbtID:b.get("xbtProductID"),XbtParentProduct:b.get("xbtParentProduct"),StartIndex:"0",XbtProductCode:b.get("xbtProductCode")},f=Personify.utils.ServiceManager.getStoreManager(),a=f.getExhibitorStore(),c=Ext.create(a);c.setDataRequest(e);c.load({callback:function(h,g,i){d.setExhibitorData(c)},scope:d})},onTapSegBtnAllEx:function(){var a=this.getPanelExhibitorList(),b=this.getAllExhibitorList();a.setActiveItem(b)},onTapSegBtnMyEx:function(){var a=Personify.utils.Configuration.getCurrentUser(),c=this.getPanelExhibitorList(),d=this.getMyExhibitorList();if(a&&a.isLogged()){c.setActiveItem(d)}else{var b=this.getSegmentButtonAllExhibitor(),e=this.getSegmentedbutton();e.setPressedButtons(b);Personify.utils.ItemUtil.needToLogin()}},getAllExhibitorFromSql:function(c,g){var b=Personify.utils.Configuration.getCurrentUser(),d=this.getExhibitorStore();if(b&&b.isLogged()){var e=c.get("productID")||null,f=b.get("masterCustomerId"),a=b.get("subCustomerId");Personify.utils.Sqlite.getMyExhibitor(e,f,a,function(h){if(typeof h=="object"&&h.length>0){d.each(function(k){for(var j=0;j<h.length;j++){if(h[j].exhibitorId==k.get("recordId")){k.set("isAdded",true)}}})}if(typeof g=="function"){g(d)}})}else{if(typeof g=="function"){g(d)}}},ontapAllExhibitorItem:function(a){this.getView().fireEvent("onexhibitortap",a)},updateExhibitorStore:function(){var a=this.getView().getRecord();this.getAllExhibitorFromSql(a)},onTapInMySchedule:function(a){this.getAllExhibitorList().getController().onTapBtnDelProductAllExhibitor(a)},updateAddMyScheduleButton:function(a){this.getView().fireEvent("updateAddMyScheduleButton",a)}});