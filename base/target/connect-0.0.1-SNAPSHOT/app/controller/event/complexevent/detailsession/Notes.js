Ext.define("Personify.controller.event.complexevent.detailsession.Notes",{extend:"Personify.base.Controller",config:{addButton:null},control:{addNotePanel:{addnotesuccess:"onAddNoteSuccess",canceladdnote:"onCancelAddNote"},shareCurrentButton:{tap:"onShareCurrentButton"},deleteNoteButton:{tap:"onDeleteNoteButton"},closeButton:{tap:"onCloseNote"},addNotePanel:{},inputTitleNote:{},inputDescriptionNote:{}},init:function(){this.callParent(arguments);var a=this.getView().getEventId();var b=this.getView().getSessionId();this.getAddNotePanel().setEventId(a);this.getAddNotePanel().setSessionId(b);this.loadNoteList();if(this.getView().getShowCloseButton()){this.getCloseButton().show()}},onAddNoteSuccess:function(){this.loadNoteList();this.onCancelAddNote()},openAddNewNotePanel:function(){var a=this.getView().getRecord();var b=a.get("title")?a.get("title"):a.get("name");this.getAddNotePanel().getController().onClearTextFields();this.getAddNotePanel().getController().getInputTitleNote().setValue(b);this.getAddNotePanel().show();this.getNoteListPanel().hide()},onCancelAddNote:function(){this.getAddNotePanel().hide();this.getNoteListPanel().show()},loadNoteList:function(){var c=this;var b={eventId:c.getView().getEventId(),sessionId:c.getView().getSessionId()};var d=Personify.utils.ServiceManager.getStoreManager();var a=Ext.create(d.getNoteListStore());a.setDataRequest(b);a.load({callback:function(g,f,j){if(g[0]){var h=g[0];c.getInputTitleNote().setValue(h.get("title"));c.getInputDescriptionNote().setValue(h.get("description"));c.getAddNotePanel().getController().setNoteItemId(h.get("noteId"));c.getDeleteNoteButton().show()}else{var e=c.getView().getRecord();var i=e.get("title")?e.get("title"):e.get("name");c.getAddNotePanel().getController().getInputTitleNote().setValue(i);c.getDeleteNoteButton().hide()}}})},onShareCurrentButton:function(){this.getAddNotePanel().getController().onShareCurrentNote()},onDeleteNoteButton:function(){var b=this;Ext.Msg.confirm("","Do you want to delete the note?",a);function a(c){if(c=="yes"){b.getAddNotePanel().getController().onDeleteNoteButton(function(){var d=b.getView().getRecord();b.getDeleteNoteButton().hide();var e=d.get("title")?d.get("title"):d.get("name");b.getAddNotePanel().getController().getInputTitleNote().setValue(e)})}}},onCloseNote:function(){this.getView().fireEvent("close")}});