Ext.define("Personify.controller.event.complexevent.detailsession.SessionHeaderDetail",{extend:"Personify.base.Controller",control:{daySession:true,timeSession:true,statusSession:true,titleHeaderDetail:true,price:true,memberPrice:true,labelMemberPrice:true,labelListPrice:true,location:true,timeZone:true,shareButton:{tap:"onTapShareButton"},shareCalendar:{tap:"onTapShareCalendar"},inMySchedule:{tap:"onInMyScheduleTap"},mapItDetailComplex:{tap:"onTapMapItDetail"},backToSessionList:{tap:"backToSessionList"}},config:{data:null},setRecord:function(f){if(f.get("isAdded")){this.getInMySchedule().setCls("p-button-RemoveSchedule");this.getInMySchedule().setHtml("Remove")}else{this.getInMySchedule().setCls("p-button-AddToSchedule");this.getInMySchedule().setHtml("Add to My<br/>Schedule")}this.getView().setRecord(f);var k=this;var b=Personify.utils.ItemUtil.changeTimeSession(Personify.utils.ItemUtil.convertStringToDateSession(f.get("startDateTimeString")));var i=Personify.utils.ItemUtil.changeTimeSession(Personify.utils.ItemUtil.convertStringToDateSession(f.get("endDateTimeString")));var m=f.get("price")?f.get("price"):0;var h=f.get("memberPrice")?f.get("memberPrice"):0;var a=f.get("yourPrice")?f.get("yourPrice"):0;var l=f.get("yourPriceRateStructure")?f.get("yourPriceRateStructure").trim().toLowerCase():"list";var g=Personify.utils.ItemUtil.formatPurchaseAmount(m,2);var j=Personify.utils.ItemUtil.formatPurchaseAmount(h,2);var d=Personify.utils.ItemUtil.formatPurchaseAmount(a,2);var e=Personify.utils.ItemUtil.checkProductStatus(f.get("productStatus"));k.setData(f);k.getDaySession().setHtml(Personify.utils.ItemUtil.formatJSONDate(Personify.utils.ItemUtil.convertStringToDateSession(f.get("startDateTimeString"))));k.getTimeSession().setHtml(b+'<div class="type-time-p-headerdetailevent">to</div>'+i);k.getStatusSession().setHtml(e);k.getTitleHeaderDetail().setHtml(f.get("title"));k.getPrice().setHtml(g);var c=Personify.utils.Configuration.getCurrentUser();if(c.isLogged()){if(l=="list"){k.getLabelMemberPrice().setHtml("Member Price : ");k.getMemberPrice().setHtml(j);k.getLabelListPrice().setHtml("Your Price: ");k.getPrice().setHtml(d)}else{k.getMemberPrice().setHtml(d);k.getLabelMemberPrice().setHtml("Your Price : ");k.getLabelListPrice().setHtml("List Price: ")}}else{k.getMemberPrice().setHtml(j)}k.getLocation().setHtml(f.get("locationDescription"));k.getTimeZone().setHtml(f.get("timeZoneCode"));if(f){if(!f.get("location")||f.get("location")===""){this.getMapItDetailComplex().hide()}else{this.getMapItDetailComplex().show();var o=Personify.utils.Configuration.getConfiguration().getAt(0).EventsStore.get("mapData");if(o){var n=o.locations[f.get("location")];if(!n){this.getMapItDetailComplex().hide()}}}}},backToSessionList:function(){if(!Personify.utils.Configuration.getAllowChangeView()){Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn);return}this.getView().getParent().getParent().getParent().setActiveItem(0)},onTapMapItDetail:function(){if(Personify.utils.Configuration.getAllowChangeView()){this.getView().fireEvent("onmaptap")}else{Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn)}},onInMyScheduleTap:function(){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}if(Personify.utils.Configuration.getAllowChangeView()){var a=Personify.utils.Configuration.getCurrentUser();if(a&&a.isLogged()){var b=this.getView().getRecord().get("isAdded");this.getView().fireEvent("oninmyscheduletap",b)}else{Personify.utils.ItemUtil.needToLogin()}}else{Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn)}},onTapShareButton:function(){if(Personify.utils.Configuration.getAllowChangeView()){Personify.utils.ItemUtil.onShareSessionDetail(this.getData())}else{Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn)}},onTapShareCalendar:function(){if(Personify.utils.Configuration.getAllowChangeView()){var g=this;if(window.plugins.calendarPlugin&&window.plugins.calendarPlugin.createEvent){var e=g.getData();var a={};var h=e.get("title");var b=new Date(e.get("startDateTimeString"));var f=new Date(e.get("endDateTimeString"));var i=e.get("locationDescription");var d=Personify.utils.ItemUtil.formatJSONDate(e.get("startDateTimeString"),"g:i a")+" - "+Personify.utils.ItemUtil.formatJSONDate(e.get("endDateTimeString"),"g:i a");var c=Personify.utils.ItemUtil.formatJSONDate(b)+" - "+Personify.utils.ItemUtil.formatJSONDate(f);body="Title: "+h+"\nDate: "+c+"\nTime: "+d+"\n";if(i&&i!=""){body+="Location: "+i}a.title=h;a.location=i;a.startDate=e.get("startDateTime");a.endDate=e.get("endDateTime");a.body=body;a.calendarName=h;window.plugins.calendarPlugin.createEvent(a,function(){Ext.Msg.alert("","Saved to calendar successfully.",Ext.emptyFn)},function(){if(Ext.os.is.Android){Ext.Msg.alert("Calendar","To use this function, you have to allow this mobile application to access your contacts",Ext.emptyFn)}else{Ext.Msg.alert("Calendar","To use this function, you have to allow this mobile application to access your contacts by changing iOS settings in Settings > Privacy > Calendars",Ext.emptyFn)}})}}else{Ext.Msg.alert("","Please enter the note title.",Ext.emptyFn)}}});