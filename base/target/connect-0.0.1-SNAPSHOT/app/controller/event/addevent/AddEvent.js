Ext.define("Personify.controller.event.addevent.AddEvent",{extend:"Personify.base.Controller",control:{singledayButton:{tap:"onSingleDayTap"},multipledayButton:{tap:"onMultipleDaysTap"},eventDayCard:true,bothDatePicker:{change:"onBothDatePickerChanged",show:"hideAndroidKeyBoard"},startDatePicker:{change:"onStartDatePickerChanged",show:"hideAndroidKeyBoard"},endDatePicker:{change:"onEndDatePickerChanged",show:"hideAndroidKeyBoard"},addPersonalEventButton:{tap:"onAddPersonalEventButtonTap"},singleStartTime:{change:"onSingleStartTimeChanged",show:"hideAndroidKeyBoard"},singleEndTime:{change:"onSingleEndTimeChanged",show:"hideAndroidKeyBoard"},eventTitle:true,eventDescription:true,eventLocation:true,addEventTitle:{},addEventClose:{tap:"onAddEventCloseTaped"}},config:{startDate:new Date(),endDate:new Date(),isSingleDate:true},init:function(){if(window.plugins.app47){window.plugins.app47.sendGenericEvent("Session Add To Calendar")}this.updateDate()},updateDate:function(){var c,b,a,d;c=Personify.utils.ItemUtil.roundMinutes(new Date());if(c.getHours()==23){b=new Date();b.setHours(23);b.setMinutes(59)}else{b=Personify.utils.ItemUtil.oneHourLater(new Date())}a=Personify.utils.ItemUtil.roundMinutes(new Date());d=Personify.utils.ItemUtil.oneDateLater(a);this.getStartDatePicker().setValue(a);this.getEndDatePicker().setValue(d);this.getSingleStartTime().setValue(c);this.getSingleEndTime().setValue(b);this.getBothDatePicker().setValue(c);if(this.getIsSingleDate()){this.setStartDate(c);this.setEndDate(b)}else{this.setStartDate(a);this.setEndDate(d)}},onSingleDayTap:function(){this.setIsSingleDate(true);this.updateDate();this.getEventDayCard().setHeight(162);this.getEventDayCard().animateActiveItem(0,{type:"slide",direction:"right",duration:500})},onMultipleDaysTap:function(){this.setIsSingleDate(false);this.updateDate();this.getEventDayCard().setHeight(108);this.getEventDayCard().animateActiveItem(1,{type:"slide",direction:"left",duration:500})},onBothDatePickerChanged:function(c,e){var b=Ext.Date.format(this.getBothDatePicker().getValue(),"m/d/Y");var d=Ext.Date.format(this.getSingleStartTime().getValue(),"h:i A");var a=Ext.Date.format(this.getSingleEndTime().getValue(),"h:i A");this.getSingleStartTime().setValue(Ext.Date.parse(b+" "+d,"m/d/Y h:i A"));this.getSingleEndTime().setValue(Ext.Date.parse(b+" "+a,"m/d/Y h:i A"));this.setStartDate(this.getSingleStartTime().getValue());this.setEndDate(this.getSingleEndTime().getValue())},onSingleStartTimeChanged:function(d,f){if(typeof f=="object"){f=Ext.Date.format(f,"h:i A")}var c=Ext.Date.format(this.getBothDatePicker().getValue(),"m/d/Y");var e=Ext.Date.parse(c+" "+f,"m/d/Y h:i A");var b=Ext.Date.format(this.getSingleEndTime().getValue(),"h:i A");var a=Ext.Date.parse(c+" "+b,"m/d/Y h:i A");this.setStartDate(e);if(e>a){this.getSingleEndTime().setValue(e);this.setEndDate(e)}else{this.setEndDate(a)}},onSingleEndTimeChanged:function(c,f){if(typeof f=="object"){f=Ext.Date.format(f,"h:i A")}var b=Ext.Date.format(this.getBothDatePicker().getValue(),"m/d/Y");var e=Ext.Date.parse(b+" "+f,"m/d/Y h:i A");var a=Ext.Date.format(this.getSingleStartTime().getValue(),"h:i A");var d=Ext.Date.parse(b+" "+a,"m/d/Y h:i A");this.setEndDate(e);if(e<d){this.getSingleStartTime().setValue(e);this.setStartDate(e)}else{this.setStartDate(d)}},onStartDatePickerChanged:function(a,b){b=new Date(b);this.setStartDate(b);if(b>this.getEndDate()){this.setEndDate(b);this.getEndDatePicker().setValue(b)}},onEndDatePickerChanged:function(a,b){b=new Date(b);this.setEndDate(b);if(b<this.getStartDate()){this.setStartDate(b);this.getStartDatePicker().setValue(b)}},onAddPersonalEventButtonTap:function(){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}Ext.Viewport.setMasked({xtype:"loadmask",message:"Saving..."});var h=this;var j=this.getEventTitle().getValue();j=j?j.trim():"";var l=this.getEventDescription().getValue();l=l?l.trim():"";var k=this.getEventLocation().getValue();k=k?k.trim():"";var a=this.getStartDate();var g=this.getEndDate();var i="";if(j==""){i+="Event Name <br>"}if(l==""){i+="Event Details <br>"}if(i==""){var b=Personify.utils.Configuration.getCurrentUser();var e=this.getView().getRecord();var c=0;var d="Personal event";if(e){c=e.get("productID")}if(c){d="Personal session"}b.addPersonalEvent(j,l,a,g,k,c).then({success:function(){h.getView().fireEvent("refreshagenda");Ext.Msg.alert("",d+" has been added to your schedule.")},failure:function(){Ext.Msg.alert("","Error occurred while adding "+d)}}).always(function(){h.getView().destroy();Ext.Viewport.setMasked(false)})}else{var f="Please check your input for: <br>"+i;Ext.Msg.alert("",f,Ext.emptyFn);Ext.Viewport.setMasked(false)}},hideAndroidKeyBoard:function(){this.getEventTitle().blur();this.getEventDescription().blur();this.getEventLocation().blur();if(Ext.os.is("Android")){if(window.plugins.androidHelper){window.plugins.androidHelper.hideAndroidKeyBoard()}}},onAddEventCloseTaped:function(){this.hideAndroidKeyBoard();var a=this.getView();Ext.callback(function(){a.destroy()},a,null,200)}});