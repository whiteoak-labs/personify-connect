Ext.define("Personify.controller.event.simpleEvent.SimpleEventHeader",{extend:"Personify.base.Controller",requires:"Personify.utils.ItemUtil",control:{daySession:true,timeSession:true,statusSession:true,titleHeaderDetail:true,price:true,memberPrice:true,labelMemberprice:true,labelListPrice:true,location:true,fullAddress:{onTapAddressList:"onTapAddressList"},timeZone:true,shareButton:{tap:"onTapShareButton"},shareCalendar:{tap:"onTapShareCalendar"},inMySchedule:{tap:"inMyScheduleTap"},mapItDetailComplex:{tap:"onTapMapItDetail"}},config:{data:null,address:null},setRecord:function(f){if(f!=null){this.updateAddRemoveButton(f);this.getView().setRecord(f);var j=this;var c=Personify.utils.ItemUtil.changeTimeSession(Personify.utils.ItemUtil.convertStringToDate(f.get("startDateTimeString")));var h=Personify.utils.ItemUtil.changeTimeSession(Personify.utils.ItemUtil.convertStringToDate(f.get("endDateTimeString")));var g=Personify.utils.ItemUtil.formatPurchaseAmount(f.get("price"),2);var i=Personify.utils.ItemUtil.formatPurchaseAmount(f.get("memberPrice"),2);var e=Personify.utils.ItemUtil.formatPurchaseAmount(f.get("yourPrice"),2);var m=f.get("yourPriceRateStructure")?f.get("yourPriceRateStructure").trim().toLowerCase():"list";var b=Personify.utils.ItemUtil.getWidthPrice(f.get("price"),f.get("memberPrice"),9);var a=Personify.utils.ItemUtil.getMeetingTag(f.get("meetingTag"));var l=Personify.utils.ItemUtil.getMeetingTagCls(f.get("meetingTag"));var k=f.get("locationFullAddress").split("\r\n").join(", ");this.setAddress(k);j.getStatusSession().setHtml(a);j.getStatusSession().setCls(l);j.setData(f);j.getDaySession().setHtml(Personify.utils.ItemUtil.formatJSONDate(Personify.utils.ItemUtil.convertStringToDate(f.get("startDateTimeString"))));j.getTimeSession().setHtml(c+'<div class="type-time-p-headerdetailevent">to</div>'+h);j.getTitleHeaderDetail().setHtml(f.get("shortName"));j.getPrice().setHtml(g);var d=Personify.utils.Configuration.getCurrentUser();if(d&&d.isLogged()){if(m=="list"){j.getMemberPrice().setHtml(i);j.getLabelListPrice().setHtml("Your Price: ");j.getPrice().setHtml(e);j.getLabelMemberprice().setHtml("Member Price :")}else{j.getMemberPrice().setHtml(e);j.getLabelMemberprice().setHtml("Your Price :");j.getLabelListPrice().setHtml("List Price: ")}}else{j.getMemberPrice().setHtml(i)}j.getPrice().setWidth(b);j.getMemberPrice().setWidth(b);j.getLocation().setHtml(f.get("location"));j.getFullAddress().setHtml(k);j.getTimeZone().setHtml(f.get("timeZoneCode"))}},inMyScheduleTap:function(){if(!Personify.utils.PhoneGapHelper.checkConnection()){Ext.Msg.alert("Connection","Please check your internet connection.",Ext.emptyFn);return}var b=this;var a=Personify.utils.Configuration.getCurrentUser();if(a&&a.isLogged()){var c=this.getView().getRecord().get("isAdded");if(c){b.getView().fireEvent("deleteagenda")}else{this.getView().fireEvent("addagenda")}}else{Personify.utils.ItemUtil.needToLogin()}},onTapShareButton:function(b,c,a){if(this.getData){Personify.utils.ItemUtil.onShareEvent(this.getData())}},onTapShareCalendar:function(){var h=this;if(window.plugins.calendarPlugin&&window.plugins.calendarPlugin.createEvent){var a={};var e=h.getData();var i=e.get("shortName");var d=Personify.utils.ItemUtil.formatJSONDate(Personify.utils.ItemUtil.convertStringToDate(e.get("startDateTimeString")));var b=Personify.utils.ItemUtil.formatJSONDate(Personify.utils.ItemUtil.convertStringToDate(e.get("startDateTimeString")),"g:i a");var g=Personify.utils.ItemUtil.formatJSONDate(Personify.utils.ItemUtil.convertStringToDate(e.get("endDateTimeString")),"g:i a");var c=b+" - "+g;var j=e.get("locationFullAddress");var f="Title: "+i+"\nDate: "+d+"\nTime: "+c+"\nLocation: "+j;a.title=i;a.location=j;a.startDate=e.get("startDateTime");a.endDate=e.get("endDateTime");a.body=f;a.calendarName=i;window.plugins.calendarPlugin.createEvent(a,function(){Ext.Msg.alert("","Saved to calendar successfully.",Ext.emptyFn)},function(){if(Ext.os.is.Android){Ext.Msg.alert("Calendar","To use this function, you have to allow this mobile application to access your contacts",Ext.emptyFn)}else{Ext.Msg.alert("Calendar","To use this function, you have to allow this mobile application to access your contacts by changing iOS settings in Settings > Privacy > Calendars",Ext.emptyFn)}})}},onTapMapItDetail:function(){this.getView().fireEvent("onmaptap")},updateAddRemoveButton:function(a){if(a.get("isAdded")){this.getInMySchedule().setCls("p-button-RemoveSchedule");this.getInMySchedule().setHtml("Remove")}else{this.getInMySchedule().setCls("p-button-AddToSchedule");this.getInMySchedule().setHtml("Add to My<br/>Schedule")}},onTapAddressList:function(){var a=this.getAddress();if(a){Personify.utils.ItemUtil.showAddressOnMaps(a)}}});