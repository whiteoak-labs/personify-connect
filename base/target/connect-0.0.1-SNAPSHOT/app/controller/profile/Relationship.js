Ext.define("Personify.controller.profile.Relationship",{extend:"Personify.base.Controller",config:{params:null,currentContact:null,totalRelationshipResult:0},control:{relationshipList:{scrollend:"onNextButtonTap"}},init:function(){var a=Personify.utils.Configuration.getCurrentUser();var b=Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore;var c={MasterCustomerId:"",SubCustomerId:"",StartIndex:1,ItemsPerPage:b.get("itemPerPage"),OrgID:a?a.get("organizationId"):b.get("orgId"),OrgUnitID:a?a.get("organizationUnitId"):b.get("orgUnitId")};this.setParams(c)},loadContactData:function(b){var c=Personify.utils.Configuration.getConfiguration().getAt(0).ConfigStore.DefaultListingParamsStore.getAt(0);var d=this;d.setCurrentContact(b);var e=d.getParams();e.MasterCustomerId=b.get("masterCustomerId");e.SubCustomerId=b.get("subCustomerId");e.OrgId=(b.get("organizationId")!=null)?b.get("organizationId"):c.get("orgId");e.OrgUnitId=(b.get("organizationUnitId")!=null)?b.get("organizationUnitId"):c.get("orgUnitId");d.getView().setMasked({xtype:"loadmask"});var g=Personify.utils.ServiceManager.getStoreManager();var a=g.getProfileRelationshipStore();var f=Ext.create(a,{dataRequest:e});f.load({callback:function(j,i,l){if(l&&j.length&&!d.getView().isDestroyed){var k=j[0];var h=d.getRelationshipList().getStore();if(h){k.RelationshipStore.each(function(m){h.add(m)});d.getRelationshipList().setStore(h)}else{d.getRelationshipList().setStore(k.RelationshipStore);h=k.RelationshipStore}if(k){d.setTotalRelationshipResult(k.get("totalResults"))}d.getView().setMasked(false)}},scope:d})},onNextButtonTap:function(){var c=this.getCurrentContact();var b=this.getRelationshipList().getStore();var a=0;if(b){a=b.getCount()}console.log("load");if(c&&a<this.getTotalRelationshipResult()){this.getParams()["StartIndex"]=this.getParams()["StartIndex"]+(Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("itemPerPage"));this.loadContactData(c)}},setLoadedStore:function(a){this.getRelationshipList().setStore(a.RelationshipStore);this.getRelationshipPagingPanel().getController().setPagingNavigationPanel(a.get("startIndex"),a.get("totalResults"),Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("itemPerPage"));this.getRelationshipPagingPanel().setHidden(a.RelationshipStore.getCount()==0)}});