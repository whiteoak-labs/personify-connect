Ext.define("Personify.controller.profile.PurchaseHistory",{extend:"Personify.base.Controller",control:{purchaseHistoryList:{scrollend:"onNextButtonTap"}},config:{params:null,currentContact:null,totalPurchaseHistoryResult:0},init:function(){if(window.plugins.app47){window.plugins.app47.sendGenericEvent("Profile Purchase History")}var a={MasterCustomerId:"",SubCustomerId:"",StartIndex:1,ItemsPerPage:Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("itemPerPage"),Subsystem:"ALL"};this.setParams(a)},loadContactData:function(a){this.setCurrentContact(a);var c=this;var e=Personify.utils.ServiceManager.getStoreManager();var b=Ext.create(e.getPurchaseHistoryStore());var d=c.getParams();d.MasterCustomerId=a.get("masterCustomerId");d.SubCustomerId=a.get("subCustomerId");b.setDataRequest(c.getParams());if(b.getHaveData()==false){b.on({beforeload:function(){c.getView().setMasked({xtype:"loadmask",message:"Loading",indicator:true,centered:true,fullscreen:true})},load:function(){if(b.getHaveData()==true){c.getView().setMasked(false);if(!c.getView().isDestroyed){var f=c.getPurchaseHistoryList().getStore();if(f){b.getPurchaseListStore().each(function(h){f.add(h)});c.getPurchaseHistoryList().setStore(f)}else{c.getPurchaseHistoryList().setStore(b.getPurchaseListStore());f=b.getPurchaseListStore()}if(b.getAt(0)){var g=b.getAt(0).get("totalResults");c.setTotalPurchaseHistoryResult(g)}}}}})}b.load();return b},onPrevioustButtonTap:function(){var a=this.getCurrentContact();if(a){this.getParams()["StartIndex"]=this.getParams()["StartIndex"]-(Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("itemPerPage"));this.loadContactData(a)}},onNextButtonTap:function(){var c=this.getCurrentContact();var a=0;var b=this.getPurchaseHistoryList().getStore();if(b){a=b.getCount()}if(c&&a<this.getTotalPurchaseHistoryResult()){this.getParams()["StartIndex"]=this.getParams()["StartIndex"]+(Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("itemPerPage"));this.loadContactData(c)}},setLoadedStore:function(a){this.getPurchaseHistoryList().setStore(a.getPurchaseListStore());this.getPurchaseHistoryPagingPanel().getController().setPagingNavigationPanel(a.getAt(0).get("startIndex"),a.getAt(0).get("totalResults"),Personify.utils.Configuration.getConfiguration().getAt(0).DirectoryStore.get("itemPerPage"));this.getPurchaseHistoryPagingPanel().setHidden(a.getPurchaseListStore().getCount()==0)}});