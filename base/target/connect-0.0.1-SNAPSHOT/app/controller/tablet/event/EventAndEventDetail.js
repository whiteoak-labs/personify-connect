Ext.define("Personify.controller.tablet.event.EventAndEventDetail",{extend:"Personify.base.Controller",control:{eventListPage:{eventitemlistselect:"onItemSelect",copymeetinglist:"onCopyMeetingList",gotomyschedule:"onGoToMySchedule",refreshmyschedule:"refreshMySchedule"},view:{activeitemchange:"activeItemChange"}},config:{simpleEventPage:null,complexEventPage:null,simpleEventIndex:null,complexEventIndex:null},init:function(){this.getView().setMasked(false)},onPainted:function(){Ext.Viewport.setMasked(false)},onItemSelect:function(e,d){var h=this;var b=e.get("isConference");var a=null;if(b){var f="";if(Ext.Viewport.supportsOrientation()){if(Ext.Viewport.getWindowOrientation()%180===0){f="portrait"}else{f="landscape"}}else{if(Ext.Viewport.getWindowHeight()>=Ext.Viewport.getWindowWidth()){f="portrait"}else{f="landscape"}}var g="";if(f=="landscape"){g="p-loading-normal-events-landscape"}else{g="p-loading-normal-events-portrait"}var c={xtype:"loadmask",message:"Loadingâ€¦",fullscreen:true,centered:true,cls:g};if(d!==true){Ext.Viewport.setMasked(c)}Ext.callback(function(){a=Ext.create("Personify.view.event.complexevent.ComplexEvent",{itemId:"complexeventPage",listeners:{backtoevent:{scope:h,fn:h.onBackToEvent},updateagendalist:{scope:h,fn:h.refreshMySchedule}}});h.getView().add(a);a.setRecord(e);a.getController().setCountLoad(0);a.getController().getAllDataOfChild(e,"sessionsAndDetail");h.getView().setActiveItem(1)},h,[],1)}else{a=Ext.create("Personify.view.event.simpleEvent.SimpleEvent",{itemId:"simpleEventPage",listeners:{backtoevent:{scope:h,fn:h.onBackToEvent},updatemeetinglist:{scope:h,fn:h.onUpdateEventList},refreshmyschedule:{scope:h,fn:h.refreshMySchedule}}});h.getView().add(a);a.setRecord(e);a.getController().initView();h.getView().setActiveItem(1)}this.getView().fireEvent("updatetitle",e.get("shortName"))},onBackToEvent:function(){this.getView().setActiveItem(0);this.getView().fireEvent("updatetitle","Events","eventmenuitem",true)},onGoToMySchedule:function(){var a=Personify.utils.Configuration.getCurrentUser();if(a&&a.isLogged()){this.getView().fireEvent("requestchangeview","Personify.view.ScheduleAndEventDetail",null,"My Schedule","schedulemenuitem")}else{Personify.utils.ItemUtil.needToLogin();return}},refreshData:function(){var c=this;var b=this.getView().getActiveItem();if(b.getItemId()!="eventListPage"){var a=null;if(Ext.Viewport.getOrientation()=="landscape"){a={xtype:"loadmask",message:"Loading..",fullscreen:true,centered:true,cls:"p-loading-ipad-landscape"}}else{a={xtype:"loadmask",message:"Loading..",fullscreen:true,centered:true,cls:"p-loading-ipad-portrait"}}Ext.Viewport.setMasked(a);this.getEventListPage().getController().onGetData(function(){var g=Ext.getStore("meetingListtingMain");var e=b.getRecord();var f=null;for(var d=0;d<g.getCount();d++){f=g.getAt(d);if(f.get("productID")==e.get("productID")){e.set("badgeData",f.get("badgeData"));break}}b.refresh()})}else{b.refresh()}},onUpdateEventList:function(){this.getEventListPage().getController().onGetData();this.getEventListPage().getController().combineFilter()},onCopyMeetingList:function(b,a){this.getView().getParent().fireEvent("copymeetinglist",b,a)},refreshMySchedule:function(){this.getView().getParent().fireEvent("updateagendalist")},activeItemChange:function(b,d,a,c){if(d.getItemId()=="eventListPage"){b.remove(a,true)}}});